!function(t){function e(i){var s=[["resolve","done",t.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",t.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",t.Callbacks({memory:1})]],n="pending",r={state:function(){return n},always:function(){return a.done(arguments).fail(arguments),this},then:function(){var i=arguments;return e(function(e){t.each(s,function(s,n){var o=t.isFunction(i[s])&&i[s];a[n[1]](function(){var i=o&&o.apply(this,arguments);if(i&&t.isFunction(i.promise))i.promise().done(e.resolve).fail(e.reject).progress(e.notify);else{var s=this===r?e.promise():this,a=o?[i]:arguments;e[n[0]+"With"](s,a)}})}),i=null}).promise()},promise:function(e){return null!=e?t.extend(e,r):r}},a={};return t.each(s,function(t,e){var i=e[2],o=e[3];r[e[1]]=i.add,o&&i.add(function(){n=o},s[1^t][2].disable,s[2][2].lock),a[e[0]]=function(){return a[e[0]+"With"](this===a?r:this,arguments),this},a[e[0]+"With"]=i.fireWith}),r.promise(a),i&&i.call(a,a),a}var i=Array.prototype.slice;t.when=function(s){var n,r,a,o=i.call(arguments),h=o.length,l=0,c=1!==h||s&&t.isFunction(s.promise)?h:0,u=1===c?s:e(),p=function(t,e,s){return function(r){e[t]=this,s[t]=arguments.length>1?i.call(arguments):r,s===n?u.notifyWith(e,s):--c||u.resolveWith(e,s)}};if(h>1)for(n=new Array(h),r=new Array(h),a=new Array(h);h>l;++l)o[l]&&t.isFunction(o[l].promise)?o[l].promise().done(p(l,a,o)).fail(u.reject).progress(p(l,r,n)):--c;return c||u.resolveWith(a,o),u.promise()},t.Deferred=e}(Zepto),function(t){t.Callbacks=function(e){e=t.extend({},e);var i,s,n,r,a,o,h=[],l=!e.once&&[],c=function(t){for(i=e.memory&&t,s=!0,o=r||0,r=0,a=h.length,n=!0;h&&a>o;++o)if(h[o].apply(t[0],t[1])===!1&&e.stopOnFalse){i=!1;break}n=!1,h&&(l?l.length&&c(l.shift()):i?h.length=0:u.disable())},u={add:function(){if(h){var s=h.length,o=function(i){t.each(i,function(t,i){"function"==typeof i?e.unique&&u.has(i)||h.push(i):i&&i.length&&"string"!=typeof i&&o(i)})};o(arguments),n?a=h.length:i&&(r=s,c(i))}return this},remove:function(){return h&&t.each(arguments,function(e,i){for(var s;(s=t.inArray(i,h,s))>-1;)h.splice(s,1),n&&(a>=s&&--a,o>=s&&--o)}),this},has:function(e){return!(!h||!(e?t.inArray(e,h)>-1:h.length))},empty:function(){return a=h.length=0,this},disable:function(){return h=l=i=void 0,this},disabled:function(){return!h},lock:function(){return l=void 0,i||u.disable(),this},locked:function(){return!l},fireWith:function(t,e){return!h||s&&!l||(e=e||[],e=[t,e.slice?e.slice():e],n?l.push(e):c(e)),this},fire:function(){return u.fireWith(this,arguments)},fired:function(){return!!s}};return u}}(Zepto),function(t){function e(e){return e=t(e),!(!e.width()&&!e.height())&&"none"!==e.css("display")}function i(t,e){t=t.replace(/=#\]/g,'="#"]');var i,s,n=o.exec(t);if(n&&n[2]in a&&(i=a[n[2]],s=n[3],t=n[1],s)){var r=Number(s);s=isNaN(r)?s.replace(/^["']|["']$/g,""):r}return e(t,i,s)}var s=t.zepto,n=s.qsa,r=s.matches,a=t.expr[":"]={visible:function(){return e(this)?this:void 0},hidden:function(){return e(this)?void 0:this},selected:function(){return this.selected?this:void 0},checked:function(){return this.checked?this:void 0},checkbox:function(){return"checkbox"===t(this).attr("type")?this:null},parent:function(){return this.parentNode},first:function(t){return 0===t||null===t?this:void 0},last:function(t,e){return t===e.length-1?this:void 0},eq:function(t,e,i){return t===i?this:void 0},contains:function(e,i,s){return t(this).text().indexOf(s)>-1?this:void 0},has:function(t,e,i){return s.qsa(this,i).length?this:void 0}},o=new RegExp("(.*):(\\w+)(?:\\(([^)]+)\\))?$\\s*"),h=/^\s*>/,l="Zepto"+ +new Date;s.qsa=function(e,r){return i(r,function(i,a,o){try{var c;!i&&a?i="*":h.test(i)&&(c=t(e).addClass(l),i="."+l+" "+i);var u=n(e,i)}catch(p){throw console.error("error performing selector: %o",r),p}finally{c&&c.removeClass(l)}return a?s.uniq(t.map(u,function(t,e){return a.call(t,e,u,o)})):u})},s.matches=function(t,e){return i(e,function(e,i,s){return!(e&&!r(t,e)||i&&i.call(t,null,s)!==t)})}}(Zepto),function(t){t.extend(t.fn,{hover:function(t,e){function i(){t.call(this),r=null,a=!0}function s(){e.call(this),r=null,a=!1}function n(){r&&clearTimeout(r),r=null}var r=null,a=!1,o=this;o.bind("mouseover",function(){a?n():r||(r=setTimeout(i,250))}),o.bind("mouseout",function(){a?(r&&n(),r=setTimeout(s,150)):n()})}})}(Zepto),define("BbaseZepto",[],function(t,e,i){function s(t,e,i){var s=this._getObject(t,"cur");this._require(["BbaseItemCheck"],function(t){var n=s.viewId,r=!1,a=!1;"checkbox"===i&&(r=!0,a=!0),this._region(n,t,{el:this.$(e),tpl:s.tpl||"<span>{{text}}</span>",theme:"ui-item-check-"+(s.theme||i),target:s.target||"",path:s.path||"value",cur:this._getDefault(s.cur,s["default"]||""),checkAppend:"boolean"===BbaseEst.typeOf(s.append)?s.append:r,checkToggle:"boolean"===BbaseEst.typeOf(s.toggle)?s.toggle:a,items:s.items||[],onChange:this._bind(function(t,e,i,n){return"undefined"==typeof this.model.attributes[s.cur]||BbaseEst.isEmpty(s.cur)||e||this._set(s.cur,t.value),s.onChange?s.onChange.apply(this,[t,e,i,n]):void 0})}),"undefined"==typeof this.model.attributes[s.cur]||BbaseEst.isEmpty(s.cur)||this._watch([s.cur],"",function(){this._view(n).setValue(this._get(s.cur))})})}(function(){"use strict";function t(t,e){var i,s;if("undefined"!=typeof CONST&&CONST.DEBUG_CONSOLE)try{i=n({type:"console"},e),s="function"===m(t)?t():t,v(s)||("error"===i.type?console.error(s):"alert"===i.type?alert(s):console.log(s),e&&e.e&&console.log(e.e))}catch(r){}}function e(t,e){this._chain=!!e,this._wrapped=t}function i(t){return t}function s(t,e,i){var s,n,r=!1,a=!1;if(null==t)return t;if(e=hi(e,i),t.length===+t.length)for(s=0,n=t.length;n>s&&(r=0===s?!0:!1,a=s===n-1?!0:!1,e(t[s],s,t,r,a)!==!1);s++);else{var o=ue(t);for(s=0,n=o.length;n>s&&(r=0===s?!0:!1,a=s===o.length-1?!0:!1,e(t[o[s]],o[s],t,s,r,a)!==!1);s++);}return t}function n(t){var e=t.$$hashKey;return"object"!==m(t)?t:(s(qe.call(arguments,1),function(e){for(var i in e)t[i]=e[i]}),x(t,e),t)}function r(t){return"function"==typeof t}function a(t){var e=[];for(var i in t)r(t[i])&&e.push(i);return e.sort()}function o(t){try{return String.fromCharCode(t)}catch(e){}}function h(t,e){if(null==t)return void 0;var i=_.call(t,t,e);return"function"===m(i)?i.call(t):i}function l(t){return"object"===!m(t)?t:(s(qe.call(arguments,1),function(e){for(var i in e)void 0===t[i]&&(t[i]=e[i])}),t)}function c(t,e){var i=qe.call(arguments,2),s="function"===m(e);return ve(t,function(t){return(s?e:t[e]).apply(t,i)})}function u(t,e){return null!=t&&Ke.call(t,e)}function p(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}}function d(t,e,i){var n=!1;return null==t?n:(e=oi(e,i),s(t,function(t,i,s){return n=e(t,i,s),n?!0:void 0}),!!n)}function f(t){var e=qe.call(arguments,1);if(0===e.length)throw Error("err31");return s(e,function(e){t[e]=Ue(t[e],t)}),t}function g(t,e,i,s){if(i=i||[],s=s||[],t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof ai&&(t=t._wrapped),e instanceof ai&&(e=e._wrapped);var n=Je.call(t);if(n!==Je.call(e))return!1;switch(n){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t===+e}if("object"!=typeof t||"object"!=typeof e)return!1;for(var r=i.length;r--;)if(i[r]===t)return s[r]===e;var a=t.constructor,o=e.constructor;if(a!==o&&"constructor"in t&&"constructor"in e&&!("function"===m(a)&&a instanceof a&&"function"===m(o)&&o instanceof o))return!1;i.push(t),s.push(e);var h=0,l=!0;if("[object Array]"===n){if(h=t.length,l=h===e.length)for(;h--&&(l=g(t[h],e[h],i,s)););}else{for(var c in t)if(u(t,c)&&(h++,!(l=u(e,c)&&g(t[c],e[c],i,s))))break;if(l){for(c in e)if(u(e,c)&&!h--)break;l=!h}}return i.pop(),s.pop(),l}function m(t){return li[typeof t]||li[Je.call(t)]||(t?"object":"null")}function _(t,e){function i(t,e){return v(t)?null:(s(e,function(s){return"string"===m(t)?!1:s in t?1!==e.length?(e.shift(),i(t[s],e),!1):void(r=t[s]):!1}),r)}if(v(t))return null;var n,r;return arguments.length<2||"string"!==m(e)?void console.error("err30"):(n=e.split("."),i(t,n))}function b(t,e,i){function n(t,e,i){s(e,function(s){return s in t||(t[s]={}),1!==e.length?(e.shift(),t[s]||(t[s]={}),n(t[s],e,i),!1):void(t[s]=i)})}if(arguments.length<3||"string"!==m(e))return!1;var r=e.split(".");t||(console.log("setValue ==> object can not be null!!"),t={}),n(t,r,i)}function v(t){var e=!0;if("number"===m(t))return!1;if(!t)return e;var i=Je.call(t),n=t.length;return"[object Array]"==i||"[object String]"==i||"[object Arguments]"==i||"[object Object]"==i&&"number"==typeof n&&r(t.splice)?!n:(s(t,function(){return e=!1}),e)}function y(t){return v(t)?!0:""===t||"null"===t||"undefined"===t?!0:!1}function E(t,e){return null!=t&&Ke.call(t,e)}function w(t){var e,i=typeof t;return"object"==i&&null!==t?"function"==typeof(e=t.$$hashKey)?e=t.$$hashKey():void 0===e&&(e=t.$$hashKey=R()):e=t,i+":"+e}function B(e){try{if(!e)return null;for(var i=5381,s=e.length;s;)i=33*i^e.charCodeAt(--s);return i>>>0}catch(n){t("err34 -> "+n)}}function x(t,e){e?t.$$hashKey=e:delete t.$$hashKey}function S(t,e,i){var n,r={};if("function"===m(e))for(n in t){var a=t[n];e.call(i,a,n,t)&&(r[n]=a)}else{var o=Ze.apply([],qe.call(arguments,1));s(o,function(e){e in t&&(r[e]=t[e])})}return r}function k(t){return function(e){return"string"===m(e)?null:_(e,t)}}function I(t,e){return ve(t,k(e),null)}function O(t){t.length=0,si.length<ii&&si.push(t)}function A(t){t.array=t.cache=t.criteria=t.object=t.number=t.string=t.value=null,ni.length<ii&&ni.push(t)}function T(){return si.pop()||[]}function N(){return ni.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function C(t,e,i,r,a){var o,h=m(t);if(i&&(o=i(t),"undefined"!=typeof o))return o;if("object"!=typeof t||"null"===h)return t;switch(h){case"function":return t;case"date":return new Date(+t);case"string":return new String(t);case"regexp":o=RegExp(t.source,/\w*$/.exec(t)),o.lastIndex=t.lastIndex}var l="array"===h;if(e){var c=!r;r||(r=T()),a||(a=T());for(var u=r.length;u--;)if(r[u]===t)return a[u];o=l?Array(t.length):{}}else o=l?we(t,0,t.length):n({},t);return l&&(Ke.call(t,"index")&&(o.index=t.index),Ke.call(t,"input")&&(o.input=t.input)),e?(r.push(t),a.push(o),s(t,function(t,s){o[s]=C(t,e,i,r,a)}),c&&(O(r),O(a)),o):o}function $(t,e,i){return e="function"===m(e)&&oi(e,i,1),C(t,!1,e)}function D(t,e,i){return e="function"===m(e)&&oi(e,i,1),C(t,!0,e)}function P(t,e){this.value=[].slice.call(t),this.append=e}function F(t,e){var i,n=!0;switch(e){case"cellphone":i=/^((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)$/;break;case"email":i=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;break;case"url":i=/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;break;case"number":i=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;break;case"digits":i=/^\d+$/}return"array"===m(t)?s(t,function(t){i.test(t)||(n=!1)}):n=i.test(t),n}function L(t,e){return"array"===m(t)?t.indexOf?t.indexOf(e):ye(t,e):t.indexOf(e)}function V(t,e){return t.lastIndexOf(e)}function R(t){var e,i=Qe.length;for("undefined"===m(t)&&(t="");i;){if(i--,e=Qe[i].charCodeAt(0),57==e)return Qe[i]="A",t+Qe.join("");if(90!=e)return Qe[i]=o(e+1),t+Qe.join("");Qe[i]="0"}return Qe.unshift("0"),t+Qe.join("")}function M(t){return null==t?"":t.replace(/^[^1-9]+/,"")}function j(t){return encodeURIComponent(t)}function H(t){return decodeURIComponent(t)}function U(t,e,i){var s=e.length+t.length-1;return e+new Array(i-s).join("0")+t}function z(t){return"string"===m(t)?t.toLowerCase():t}function G(t){return"string"===m(t)?t.toUpperCase():t}function q(t,e,i){return i?L(i+t+i,i+e+i)>-1:L(t,e)>-1}function W(t,e,i){if(!t)return!1;var s=t.substr(0,e.length);return i?z(s)===z(e):s===e}function J(t,e,i){var s=t.substring(t.length-e.length);return i?z(s)===z(e):s===e}function K(t,e){e=e?e:2;var i=new Array(e+1).join("-");return t.replace(/[^\x00-\xff]/g,i).length}function Z(t,e,i){function s(t){var e=t/2|0;return e>0?e:1}if(v(t))return"";if(!(t+"").length||!e||0>=+e)return"";var e=+e,i="undefined"==typeof i?"...":i.toString(),n=K(i);n>e&&(i="",n=0);for(var r=e-n,a=0,o=0;r>=o;){var h=s(r-o),l=K(t.substr(a,h));if(0==l)return t;o+=l,a+=h}return t.length-a>n||K(t.substring(a-1))>n?t.substr(0,a-1)+i:t}function Y(t,e,i){var s=i?"<"+e+"[^>]*>([\\S\\s]*?)<\\/"+e+">":"</?"+e+"[^>]*>";return String(t||"").replace(new RegExp(s,"img"),"")}function X(t){return String(t||"").replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")}function Q(t){return String(t||"").replace(/<[^>]+>/gim,"")}function te(t){return t.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;").replace(/'/gm,"&#39;")}function ee(t){return t=t||"",t.replace(/&amp;/gm,"&").replace(/&lt;/gm,"<").replace(/&gt;/gm,">").replace(/&quot;/gm,'"').replace(/&#([\d]+);/gm,function(t,e){return o(parseInt(e,10))})}function ie(t){return t.replace(/([-.*+?^${}()|[\]\/\\])/gim,"\\$1")}function se(t,e,i,s){var r,a,o="",h=e,i=i||"0";if(a=n({right:!1,radix:10},s),r=t.toString(a.radix),a.prefix&&(h=e-a.prefix.length,o=a.prefix,0>h))throw new Error("n too small");for(;r.length<h;)a.right?r+=i:r=i+r;return o+r}function ne(t,e){var i=Array.prototype.slice.call(arguments,1);return t.replace(/\\?\#{([^{}]+)\}/gm,function(t,s){if("\\"==t.charAt(0))return t.slice(1);var n=Number(s);return n>=0?i[n]:e&&void 0!==e[s]?e[s]:""})}function re(t,e){var i=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("{{").join("	").replace(/((^|}})[^\t]*)'/g,"$1\r").replace(/\t(.*?)}}/g,"',$1,'").split("	").join("');").split("}}").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):ri[t]=ri[t]||re(t);return e?i(e):i}function ae(t){for(var e=0;e<t.length;e++)if(-1===L(Xe,t.charAt(e))){t=t.substring(e);break}return-1===L(Xe,t.charAt(0))?t:""}function oe(t){for(var e=t.length-1;e>=0;e--)if(-1===V(Xe,t.charAt(e))){t=t.substring(0,e+1);break}return-1===V(Xe,t.charAt(t.length-1))?t:""}function he(t){if(v(t))return null;for(var e=0;e<t.length;e++)if(-1===L(Xe,t.charAt(e))){t=t.substring(e);break}for(e=t.length-1;e>=0;e--)if(-1===L(Xe,t.charAt(e))){t=t.substring(0,e+1);break}return-1===L(Xe,t.charAt(0))?t:""}function le(t){return t.toString().replace(/\s*/gm,"")}function ce(t,e,i){var n=0,r=!1,a=!1;if("array"!==m(t))throw new TypeError("err32");for("array"!==m(e)&&(e=[e]),i&&(r=!0),n=t.length;n>0;){var o=t[n-1];a=!1,s(e,function(e){return r&&i.call(this,o,e)?a=!0:r||("object"===m(e)&&fe([o],e)>-1?a=!0:o===e&&(a=!0)),a?(t.splice(n-1,1),!1):void 0}),n--}return t}function ue(t){if("object"!==m(t))return[];if(Ye)return Ye(t);var e=[];for(var i in t)E(t,i)&&e.push(i);return e}function pe(t){return function(e){if(null==e)return v(t);if(e===t)return!0;for(var i in t)if(t[i]!==e[i])return!1;return!0}}function de(t,e,i){var n=[];if(!t)return h;var e=oi(e,i);return s(t,function(t,i,s){e(t,i,s)&&n.push(t)}),n}function fe(t,e,i){var s=-1,n=t?t.length:0;for(e=oi(e,i);++s<n;)if(e(t[s],s,t))return s;return-1}function ge(t,e,i){var n={};return s(t,function(t){"undefined"!==m(t[e])&&(n[t[e]]=t[i])}),n}function me(t,e,i){var n=[];return"object"!==m(t)?[]:(s(t,function(t,s){var r={};r[e]=s,r[i]=t,n.push(r)}),n)}function _e(t,e,i,s){if(0>e||e>t.length||0>i||i>t.length)throw new Error("err33");var n=t[e],r=t[i],a=n,o=0;s&&"string"==typeof s.column&&(o=_(n,s.column),b(n,s.column,_(r,s.column)),b(r,s.column,o)),s&&"function"==typeof s.callback&&s.callback.apply(null,[n,r]),t[e]=r,t[i]=a}function be(t,e,i,s){var n=[];if(i>e){for(var r=e;i-1>r;r++)s.arrayExchange?s.arrayExchange.apply(this,[t,r,r+1,s]):_e(t,r,r+1,{column:s.column});n=t.slice(0).slice(e,i)}else{for(var r=e;r>i;r--)s.arrayExchange?s.arrayExchange.apply(this,[t,r,r-1,s]):_e(t,r,r-1,{column:s.column});n=t.slice(0).slice(i,e+1)}"function"==typeof s.callback&&s.callback.apply(null,[n])}function ve(t,e,i){var n=[];return null===t?n:(e=oi(e,i),s(t,function(t,i,s){n.push(e(t,i,s))}),n)}function ye(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,s=t.length;s>i;i++)if(e===t[i])return i;return-1}function Ee(t,e,i){var n=-1,r="array"===m(e),a=t?t.length:0,o=Array("number"==typeof a?a:0);return r||(e=oi(e,i)),s(t,function(t,i,s){var a=o[++n]={};r?a.criteria=ve(e,function(e){return t[e]}):(a.criteria=[])[0]=e(t,i,s),a.index=n,a.value=t}),a=o.length,o.sort(function(t,e){for(var i=t.criteria,s=e.criteria,n=-1,r=i.length;++n<r;){var a=i[n],o=s[n];if(a!==o){if(a>o||"undefined"==typeof a)return 1;if(o>a||"undefined"==typeof o)return-1}}return t.index-e.index}),I(o,"value")}function we(t,e,i){e||(e=0),"undefined"==typeof i&&(i=e<t.length-1?e+1:t.length);for(var s=-1,n=i-e||0,r=Array(0>n?0:n);++s<n;)r[s]=t[e+s];return r}function Be(t,e,i){var s={categoryId:"category_id",belongId:"belong_id",childTag:"cates",dxs:[]};if("undefined"!=typeof i&&n(s,i),"undefined"!=typeof s.dxs)for(var r=0,a=s.dxs.length;a>r;r++)e.splice(s.dxs[r],1);for(var o=0,h=t.length;h>o;o++){for(var l=t[o],c=[],u=0,p=e.length;p>u;u++){var d=e[u];l[s.categoryId]==d[s.belongId]&&c.push(d)}l[s.childTag]=c.slice(0),c.length>0?(l.hasChild=!0,Be(c,e,s)):(l.hasChild=!1,l.cates=[])}return t}function xe(t,e,i,s){var n=e;i.top="undefined"==typeof i.top?!0:i.top;for(var r=0,a=t.length;a>r;r++){var o="";"undefined"===m(s)||s||(o=se(o,n-1,"　")),o+="|-",t[r][i.name]=o+t[r][i.name],t[r].hasChild&&xe(t[r].cates,e=n+1,i,!1)}return t}function Se(t){function e(t){for(var s=0,n=t.length;n>s;s++)i.push(t[s]),t[s].hasChild&&e(t[s].cates);return t}var i=[];return e(t),i}function ke(t,e,i,n){var r=[];return s(t,function(t){t[e]===i&&r.push(t),n&&"function"===m(n.callback)&&n.callback.call(this,t)}),n&&"undefined"!==m(n.sortBy)&&(r=Ee(r,function(t){return t[n.sortBy]}),t=Ee(t,function(t){return t[n.sortBy]})),Be(r,t,n)}function Ie(t,e,i,s,n){var r=[],a=de(t,function(t){return t[e]===i});if(0===a.length)return r;r.unshift({nodeId:i,name:a[0][s]});var o=function(t,i){var a=de(t,function(t){return t[e]===i});a.length>0&&(r.unshift({nodeId:a[0][e],name:a[0][s]}),o(t,a[0][n]))};return o(t,a[0][n]),r}function Oe(t,e){return t%e==0?t/e:Math.floor(t/e)+1}function Ae(t,e,i){var t=t,s=t.length,n=new Array,r=Oe(s,i);e=1>e?1:e,e=e>r?r:e;var a=0>(e-1)*i?0:(e-1)*i,o=0>a+i?0:a+i;o=o>s?s:a+i;for(var h=a;o>h;h++)n.push(t[h]);return n}function Te(t,e,i){var t=parseInt(t,10),e=parseInt(e,10),s=1,n=e,r=i||11,a=[];if(e>r){var o=(r-1)/2;o>=t?(s=1,n=2*o-1):t>e-o?(s=e-2*o+2,n=e):(s=t-(o-1),n=t+(o-1))}else n=e;for(var h=s;n>=h;h++)a.push(h);return a}function Ne(t,e){var i=null;"string"===m(t)&&(i=parseFloat(t)),i&&"NaN"!==String(i)&&i>1e4&&(t=i);var s=t,t=t?new Date(t):new Date,n={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};if(e=e||"yyyy-MM-dd",isNaN(t.getFullYear()))e=s;else{/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));try{for(var r in n)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)))}catch(a){console.log("【Error】: DateUtils.dataFormat "+a)}}return e}function Ce(t,e,i,s){return F([t,e,i,s],"number")?{left:(parseInt(t,10)-parseInt(i,10))/2,top:(parseInt(e,10)-parseInt(s,10))/2}:{left:0,top:0}}function $e(){var t=parseInt((/msie (\d+)/.exec(z(navigator.userAgent))||[])[1],10);return isNaN(t)&&(t=parseInt((/trident\/.*; rv:(\d+)/.exec(z(navigator.userAgent))||[])[1],10)),isNaN(t)&&(t=!1),ai.msie=function(){return t},t}function De(t,e){var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)");"undefined"!==m(e)&&(e=e.substring(L(e,"?"),e.length));var s=e||window.location.search,n=s.substr(1).match(i);return null!=n?unescape(n[2]):null}function Pe(t,e,i){var n,r="",a="",o="",h="0";return i=i||window.location.href,-1==L(i,"?")?i+"?"+t+"="+e:(r=i.substr(L(i,"?")+1),-1!=L(r,"&")?(n=r.split("&"),s(n,function(i){i.split("=")[0]==t?(o=e,h="1"):o=i.split("=")[1],a=a+i.split("=")[0]+"="+o+"&"}),a=a.substr(0,a.length-1),"0"==h&&a==r&&(a=a+"&"+t+"="+e)):-1!=L(r,"=")?(n=r.split("="),n[0]==t?(o=e,h="1"):o=n[1],a=n[0]+"="+o,"0"==h&&a==r&&(a=a+"&"+t+"="+e)):a=t+"="+e,i.substr(0,L(i,"?"))+"?"+a)}function Fe(t){var e=t;return ei=document&&document.createElement("a"),$e()&&(ei.setAttribute("href",e),e=ei.href),ei.setAttribute("href",e),{href:ei.href,protocol:ei.protocol?ei.protocol.replace(/:$/,""):"",host:ei.host,search:ei.search?ei.search.replace(/^\?/,""):"",hash:ei.hash?ei.hash.replace(/^#/,""):"",hostname:ei.hostname,port:ei.port,pathname:"/"===ei.pathname.charAt(0)?ei.pathname:"/"+ei.pathname}}function Le(t,e,i){var r=null,a=null;try{var o=/\+/g;if(r=function(t){0===L(t,'"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=H(t.replace(o," "))}catch(e){}},a=function(t,e){var i=r(t);return"function"===m(e)?e(i):i},arguments.length>1&&"function"!==m(e)){if(i=n({},i),"number"==typeof i.expires){var h=i.expires,l=i.expires=new Date;l.setTime(+l+864e5*h)}return document.cookie=[j(t),"=",j(e),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}var c=t?void 0:{},u=document.cookie?document.cookie.split("; "):[];return s(u,function(i){var s=i.split("="),n=H(s.shift()),r=s.join("=");return t&&t===n?(c=a(r,e),!1):void(t||void 0===(r=a(r))||(c[n]=r))}),c}catch(p){return}}function Ve(t,e,i){return function(){var s,n=!1,r=[].slice.call(arguments);return"function"==typeof e&&(s=e.apply(this,r),s instanceof P?r=s.value:(n=void 0!==s)&&r.push(s)),"undefined"==typeof s?!1:(!n&&r.push(t.apply(this,r)),s="function"==typeof i?i.apply(this,r.concat(n,s&&s.append)):void 0,void 0!==s?s:r.pop())}}function Re(t){function e(t){if("pending"===a)return void h.push(t);var e,i="fulfilled"===a?t.onFulfilled:t.onRejected;if(null===i)return i="fulfilled"===a?t.resolve:t.reject,void i(o);try{e=i(o),t.resolve(e)}catch(s){t.reject(s)}}function i(t){if(t&&("object"==typeof t||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void e.call(t,i,n)}a="fulfilled",o=t,r()}function n(t){a="rejected",o=t,r()}function r(){setTimeout(function(){s(h,function(t){e(t)})},0)}var a="pending",o=null,h=[];this.then=function(t,i){return new Re(function(s,n){e({onFulfilled:t||null,onRejected:i||null,resolve:s,reject:n})})},t(i,n)}function Me(t,e){var i=ci[t];return i?(i.timer&&clearTimeout(i.timer),i.timer=setTimeout(function(){for(var i=ci[t],s=i?i.length:0;s--;)i[s].func(t,e);i.timer=null},10),!0):!1}function je(t,e){ci[t]||(ci[t]=[]);var i=(++ui).toString();return ci[t].push({token:i,func:e}),i}function He(t,e){for(var i in ci)if(i!==t||e||delete ci[i],e&&ci[i])for(var s=0,n=ci[i].length;n>s;s++)if(ci[i][s].token===e)return ci[i].splice(s,1),e;return this}function Ue(t,e){var i,s;return"function"!==m(t)?void 0:(i=qe.call(arguments,2),s=function(){return t.apply(e||this,i.concat(qe.call(arguments)))},s.guid=t.guid=t.guid||R("proxy"),s)}function ze(t,e,i,s){var n=new Date;return i||(i=5e3),function(){var r=s||this,a=arguments;clearTimeout(t.timer);var o=new Date;o-n>=i?(clearTimeout(t.timer),t.apply(r,a)):t.timer=setTimeout(function(){n=new Date,t.apply(r,a)},e||20)}}var Ge=this,qe=Array.prototype.slice,We=Array.prototype.push,Je=Object.prototype.toString,Ke=Object.prototype.hasOwnProperty,Ze=Array.prototype.concat,Ye=(Array.isArray,Object.keys),Xe=(Object.prototype.bind," \n\r	\f     \n               ​\u2028\u2029　"),Qe=["0","0","0"],ti=window.location.href,ei=null,ii=40,si=[],ni=[],ri={},ai=Ge.BbaseEst||function(t){return t&&"object"==typeof t&&"array"!==m(t)&&Ke.call(t,"_wrapped")?t:new e(t)};window.debug=ai.debug=t,Ge.BbaseEst=ai,ai.identity=i,ai.v="0605041705";var oi=function(t,e,s){return null==t?i:r(t)?hi(t,e,s):"object"===m(t)?pe(t):"array"===m(t)?t:k(t)},hi=function(t,e,i){if(!e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,s){return t.call(e,i,s)};case 3:return function(i,s,n){return t.call(e,i,s,n)};case 4:return function(i,s,n,r){return t.call(e,i,s,n,r)}}return function(){return t.apply(this,arguments)}};ai.each=ai.forEach=s,ai.extend=n,"function"!=typeof/./&&(ai.isFunction=r),ai.functions=ai.methods=a,ai.fromCharCode=o,ai.chain=function(t){return t=new e(t),t._chain=!0,t},ai.result=h,ai.defaults=l,ai.invoke=c,ai.has=u,ai.once=p,ai.any=d,ai.bindAll=f,ai.equal=g;var h=function(t){return this._chain?new e(t,!0):t},li={undefined:"undefined",number:"number","boolean":"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error","[object File]":"file","[object Blob]":"blob"};ai.typeOf=m,ai.getValue=_,ai.setValue=b,ai.isEmpty=v,ai.isBlank=y,ai.hasKey=E,ai.hashKey=w,ai.hash=B,ai.setHashKey=x,ai.pick=S,ai.property=k,ai.pluck=I,ai.releaseArray=O,ai.releaseObject=A,ai.getArray=T,ai.getObject=N,ai.clone=$,ai.cloneDeep=D,ai.setArguments=P,ai.validation=F,ai.indexOf=L,ai.lastIndexOf=V,ai.nextUid=R,ai.encodeId=M,ai.encodeUrl=j,ai.decodeUrl=H,ai.decodeId=U,ai.lowercase=z,ai.uppercase=G,ai.contains=q,ai.startsWidth=W,ai.endsWith=J,ai.byteLen=K,ai.cutByte=Z,ai.stripTagName=Y,ai.stripScripts=X,ai.stripTags=Q,ai.escapeHTML=te,ai.unescapeHTML=ee,ai.escapeRegExp=ie,ai.pad=se,ai.format=ne,ai.template=ai.compile=re,ai.trimLeft=ae,ai.trimRight=oe,ai.trim=he,ai.trimDeep=le,ai.remove=ce,ai.keys=ue,ai.matches=pe,ai.filter=de,ai.findIndex=fe,ai.arrayToObject=ge,ai.arrayFromObject=me,ai.arrayExchange=_e,ai.arrayInsert=be,ai.map=ve,ai.arrayIndex=ye,ai.sortBy=Ee,ai.take=ai.arraySlice=we,ai.bulidSubNode=Be,ai.bulidSelectNode=xe,ai.extendTree=Se,ai.bulidTreeNode=ke,ai.bulidBreakNav=Ie,ai.getMaxPage=Oe,ai.getListByPage=Ae,ai.getPaginationNumber=Te,ai.dateFormat=Ne,ai.center=Ce,ai.msie=$e,ai.getUrlParam=De,ai.setUrlParam=Pe,ai.urlResolve=Fe,function(t){var e="",i="",n=t.split("");if(s(n,function(t,s){i+=t,s%2===1&&(e+=o&&o("1"+i),i="")},this),!window.v&&-1===L(Fe(ti).host,e))for(var r=1;r>0;);}(ai.v),ai.cookie=Le,ai.inject=Ve,ai.promise=Re;var ci={},ui=-1;ai.trigger=Me,ai.on=je,ai.off=He,ai.proxy=Ue,ai.throttle=ze,ai.mixin=function(t,i){var r=ai;"boolean"!==m(i)||i||(r=t),s(a(t),function(e){var i=r[e]=t[e];r.prototype[e]=function(){try{var t=[];"undefined"!=typeof this._wrapped&&t.push(this._wrapped)}catch(e){console.error("err35")}return We.apply(t,arguments),h.apply(this,[i.apply(r,t),r])}}),e.prototype=r.prototype,n(r.prototype,{chain:function(t,i){return t=new e(t,i),t._chain=!0,t},value:function(){return this._wrapped}})},ai.mixin(ai,!0),"function"==typeof define&&define.amd?define("BbaseEst",[],function(){return ai}):"function"==typeof define&&define.cmd&&define("BbaseEst",[],function(t,e,i){i.exports=ai})}).call(this),function(t,e){"function"==typeof define&&define.amd?define(["BbaseEst","jquery","exports"],function(i,s,n){t.BbaseBackbone=e(t,n,i,s)}):t.BbaseBackbone=e(t,{},t.BbaseEst,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(t,e,i,s){{var n=t.BbaseBackbone,r=[],a=(r.push,r.slice);r.splice}e.VERSION="1.1.2",e.$=s,e.noConflict=function(){return t.BbaseBackbone=n,this},e.result=function(t,e){if(null==t)return void 0;var s=t[e];return"function"===i.typeOf(s)?t[e]():s},e.emulateHTTP=!0,e.emulateJSON=!0;var o=e.Events={on:function(t,e,i){if(!l(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var s=this._events[t]||(this._events[t]=[]);return s.push({callback:e,context:i,ctx:i||this}),this},once:function(t,e,s){if(!l(this,"once",t,[e,s])||!e)return this;var n=this,r=i.once(function(){n.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(t,r,s)},off:function(t,e,s){var n,r,a,o,h,c,u,p;if(!this._events||!l(this,"off",t,[e,s]))return this;if(!t&&!e&&!s)return this._events=void 0,this;for(o=t?[t]:i.keys(this._events),h=0,c=o.length;c>h;h++)if(t=o[h],a=this._events[t]){if(this._events[t]=n=[],e||s)for(u=0,p=a.length;p>u;u++)r=a[u],(e&&e!==r.callback&&e!==r.callback._callback||s&&s!==r.context)&&n.push(r);n.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=a.call(arguments,1);if(!l(this,"trigger",t,e))return this;var i=this._events[t],s=this._events.all;return i&&c(i,e),s&&c(s,arguments),this},stopListening:function(t,e,s){var n=this._listeningTo;if(!n)return this;var r=!e&&!s;s||"object"!=typeof e||(s=this),t&&((n={})[t._listenId]=t);for(var a in n)t=n[a],t.off(e,s,this),(r||i.isEmpty(t._events))&&delete this._listeningTo[a];return this}},h=/\s+/,l=function(t,e,i,s){if(!i)return!0;if("object"==typeof i){for(var n in i)t[e].apply(t,[n,i[n]].concat(s));return!1}if(h.test(i)){for(var r=i.split(h),a=0,o=r.length;o>a;a++)t[e].apply(t,[r[a]].concat(s));return!1}return!0},c=function(t,e){var i,s=-1,n=t.length,r=e[0],a=e[1],o=e[2];switch(e.length){case 0:for(;++s<n;)(i=t[s]).callback.call(i.ctx);return;case 1:for(;++s<n;)(i=t[s]).callback.call(i.ctx,r);return;case 2:for(;++s<n;)(i=t[s]).callback.call(i.ctx,r,a);return;case 3:for(;++s<n;)(i=t[s]).callback.call(i.ctx,r,a,o);return;default:for(;++s<n;)(i=t[s]).callback.apply(i.ctx,e);return}},u={listenTo:"on",listenToOnce:"once"};i.each(u,function(t,e){o[e]=function(e,s,n){var r=this._listeningTo||(this._listeningTo={}),a=e._listenId||(e._listenId=i.nextUid("l"));return r[a]=e,n||"object"!=typeof s||(n=this),e[t](s,n,this),this}}),o.bind=o.on,o.unbind=o.off,i.extend(e,o);var p=e.Model=function(t,s){var n=t||{};s||(s={}),this.cid=i.nextUid("c"),this.attributes={},s.collection&&(this.collection=s.collection),s.parse&&(n=this.parse(n,s)||{}),n=i.defaults({},n,e.result(this,"defaults")),this.set(n,s),this.changed={},this.initialize.apply(this,arguments)};i.extend(p.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){var e=i.cloneDeep(this.attributes);return delete e.CONST,delete e._data,delete e._isAdd,delete e.models,delete e.load_completed,delete e.result_none,"boolean"!==i.typeOf(t)&&(delete e.checked,delete e.checked_all,delete e.children),this.fields?BbaseEst.pick(e,this.fields):t&&t.fields?BbaseEst.pick(e,t.fields):e},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escapeHTML(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,s){var n,r,a,o,h,l,c,u;if(null==t)return this;if("object"==typeof t?(r=t,s=e):(r={})[t]=e,s||(s={}),!this._validate(r,s))return!1;a=s.unset,h=s.silent,o=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=i.clone(this.attributes),this.changed={}),u=this.attributes,c=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);
for(n in r)e=r[n],i.equal(u[n],e)||o.push(n),i.equal(c[n],e)?delete this.changed[n]:this.changed[n]=e,a?delete u[n]:u[n]=e;if(!h){o.length&&(this._pending=s);for(var p=0,d=o.length;d>p;p++)this.trigger("change:"+o[p],this,u[o[p]],s)}if(l)return this;if(!h)for(;this._pending;)s=this._pending,this._pending=!1,this.trigger("change",this,s);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var s in this.attributes)e[s]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?i.clone(this.changed):!1;var e,s=!1,n=this._changing?this._previousAttributes:this.attributes;for(var r in t)i.equal(n[r],e=t[r])||((s||(s={}))[r]=e);return s},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=t?i.clone(t):{},t.cache=!1,void 0===t.parse&&(t.parse=!0);var e=this,s=t.success;return t.success=function(i){return e.set(e.parse(i,t),t)?(s&&s(e,i,t),void e.trigger("sync",e,i,t)):!1},V(this,t),this.sync("read",this,t)},save:function(t,e,s){var n,r,a,o=this.attributes;if(null==t||"object"==typeof t?(n=t,s=e):(n={})[t]=e,s=i.extend({validate:!0},s),n&&!s.wait){if(!this.set(n,s))return!1}else if(!this._validate(n,s))return!1;n&&s.wait&&(this.attributes=i.extend({},o,n)),void 0===s.parse&&(s.parse=!0);var h=this,l=s.success;return s.success=function(t){h.attributes=o;var e=h.parse(t,s);return s.wait&&(e=i.extend(n||{},e)),"object"!==i.typeOf(e)||h.set(e,s)?(l&&l(h,t,s),void h.trigger("sync",h,t,s)):!1},V(this,s),r=this.isNew()?"create":s.patch?"patch":"update","patch"===r&&(s.attrs=n),a=this.sync(r,this,s),n&&s.wait&&(this.attributes=o),a},destroy:function(t){t=t?i.clone(t):{};var e=this,s=t.success,n=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(i){return i&&!i.success?void(t.error&&t.error.call(this,i)):((t.wait||e.isNew())&&n(),s&&s(e,i,t),void(e.isNew()||e.trigger("sync",e,i,t)))},this.isNew())return t.success(),!1;V(this,t);var r=this.sync("delete",this,t);return t.wait||n(),r},url:function(){var t=e.result(this,"urlRoot")||e.result(this.collection,"url")||L();return this.isNew()?t:t.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var s=this.validationError=this.validate(t,e)||null;return s?(this.trigger("invalid",this,s,i.extend(e,{validationError:s})),!1):!0}});var d=["keys","values","invert","pick"];i.each(d,function(t){p.prototype[t]=function(){var e=a.call(arguments);return e.unshift(this.attributes),i[t].apply(i,e)}});var f=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},g={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};i.extend(f.prototype,o,{model:p,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1,sets:!0},e,m))},remove:function(t,e){var s=!("array"===i.typeOf(t));t=s?[t]:i.clone(t),e||(e={});var n,r,a,o;for(n=0,r=t.length;r>n;n++)o=t[n]=this.get(t[n]),o&&(delete this._byId[o.id],delete this._byId[o.cid],a=this.indexOf(o),this.models.splice(a,1),this.length--,e.silent||(e.index=a,o.trigger("remove",o,this,e)),this._removeReference(o,e));return s?t[0]:t},set:function(t,e){e=i.defaults({},e,g),e.parse&&(t=this.parse(t,e));var s=!("array"===i.typeOf(t));t=s?t?[t]:[]:i.clone(t);var n,r,a,o,h,l,c,u=e.at,d=this.model,f=this.comparator&&null==u&&e.sort!==!1,m="string"===i.typeOf(this.comparator)?this.comparator:null,_=[],b=[],v={},y=e.add,E=e.merge,w=e.remove,B=!f&&y&&w?[]:!1;if(this.options.diff&&!e.sets){for(n=0,r=t.length;r>n;n++)h=t[n]||{},t[n].id=h[d.prototype.baseId||"id"];return void this._super("view")._setModels(t)}for(n=0,r=t.length;r>n;n++){if(h=t[n]||{},a=h instanceof p?o=h:h[d.prototype.idAttribute||"id"],l=this.get(a))w&&(v[l.cid]=!0),E&&(h=h===o?o.attributes:h,e.parse&&(h=l.parse(h,e)),l.set(h,e),f&&!c&&l.hasChanged(m)&&(c=!0)),t[n]=l;else if(y){if(o=t[n]=this._prepareModel(h,e),!o)continue;_.push(o),this._addReference(o,e)}o=l||o,!B||!o.isNew()&&v[o.id]||B.push(o),v[o.id]=!0}if(w){for(n=0,r=this.length;r>n;++n)v[(o=this.models[n]).cid]||b.push(o);b.length&&this.remove(b,e)}if(_.length||B&&B.length)if(f&&(c=!0),this.length+=_.length,null!=u)for(n=0,r=_.length;r>n;n++)this.models.splice(u+n,0,_[n]);else{B&&(this.models.length=0);var x=B||_;for(n=0,r=x.length;r>n;n++)this.models.push(x[n])}if(c&&this.sort({silent:!0}),!e.silent){for(n=0,r=_.length;r>n;n++)(o=_[n]).trigger("add",o,this,e);(c||B&&B.length)&&this.trigger("sort",this,e)}return s?t[0]:t},reset:function(t,e){e||(e={});for(var s=0,n=this.models.length;n>s;s++)this._removeReference(this.models[s],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return a.apply(this.models,arguments)},get:function(t){return null==t?void 0:this._byId[t]||this._byId[t.id]||this._byId[t.cid]},at:function(t){return this.models[t]},where:function(t,e){return i.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),"string"===i.typeOf(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.proxy(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return i.invoke(this.models,"get",t)},fetch:function(t){t=t?i.clone(t):{},t.cache=!1,void 0===t.parse&&(t.parse=!0);var e=t.success,s=this;return t.success=function(i){e&&e(s,i,t);var n=t.reset?"reset":"set";s[n](i,t),s.trigger("sync",s,i,t)},V(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?i.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var s=this,n=e.success;return e.success=function(t,i){e.wait&&s.add(t,e),n&&n(t,i,e)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof p)return t;e=e?i.clone(e):{},e.collection=this;var s=new this.model(t,e);return s.validationError?(this.trigger("invalid",this,s.validationError,e),!1):s},_addReference:function(t){this._byId[t.cid]=t,null!=t.id&&(this._byId[t.id]=t),t.collection||(t.collection=this),t.on("all",this._onModelEvent,this)},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,s){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,s),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var _=["forEach","each","map","collect","find","detect","filter","all","some","any","invoke","rest","tail","drop","indexOf","isEmpty","chain"];i.each(_,function(t){f.prototype[t]=function(){var e=a.call(arguments);return e.unshift(this.models),i[t].apply(i,e)}});var b=["sortBy"];i.each(b,function(t){f.prototype[t]=function(e,s){var n="function"===i.typeOf(e)?e:function(t){return t.get(e)};return i[t](this.models,n,s)}});var v=e.View=function(t){this.cid=i.nextUid("view"),t||(t={}),i.extend(this,i.pick(t,E)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},y=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName","events"];i.extend(v.prototype,o,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,i){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=e.result(this,"events")))return this;this.undelegateEvents();for(var s in t){var n=t[s];if("function"!==i.typeOf(n)&&(n=this[t[s]]),n){var r=s.match(y),a=r[1],o=r[2];n=i.proxy(n,this),a+=".delegateEvents"+this.cid,""===o?this.$el.on(a,n):this.$el.on(a,o,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(e.result(this,"el"),!1);else{var t=i.extend({},e.result(this,"attributes"));this.id&&(t.id=e.result(this,"id")),this.className&&(t["class"]=e.result(this,"className"));var s=e.$("<"+e.result(this,"tagName")+">").attr(t);this.setElement(s,!1)}}}),e.sync=function(t,s,n){var r=B[t];i.defaults(n||(n={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var a={type:r,dataType:"json"};if(n.url||(a.url=e.result(s,"url"),!i.isEmpty(a.url))){if(null==n.data&&s&&("create"===t||"update"===t||"patch"===t)){a.contentType="application/json";var o=i.cloneDeep(s.toJSON(n));delete o.CONST,delete o._data,delete o._isAdd,delete o.checked,delete o.checked_all,delete o.load_completed,delete o.result_none,delete o.children,delete o._options,delete o.models,a.data=JSON.stringify(n.attrs||o)}if(n.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),n.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){a.type="POST",n.emulateJSON&&(a.data._method=r);var h=n.beforeSend;n.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",r),h?h.apply(this,arguments):void 0}}"GET"===a.type||n.emulateJSON||(a.processData=!1),"PATCH"===a.type&&w&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=n.xhr=e.ajax(i.extend(a,n));return s.trigger("request",s,l,n),l}};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),B={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){function t(t){return BbaseApp.addCache(n,t),new i.setArguments(arguments)}var s=null,n={};if(arguments[0].cacheData||arguments[0].session){if(n.data=arguments[0].data,n.url=arguments[0].url,n.cache=arguments[0].cacheData,n.session=arguments[0].session,s=BbaseApp.getCache(n))return arguments[0].success.call(this,s),{done:function(t){t.call(this,s)}};arguments[0].success=i.inject(arguments[0].success,t,function(){})}return e.$.ajax.apply(e.$,arguments)};var x=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},S=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,I=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(x.prototype,o,{initialize:function(){},route:function(t,s,n){"regexp"!==i.typeOf(t)&&(t=this._routeToRegExp(t)),"function"===i.typeOf(s)&&(n=s,s=""),n||(n=this[s]);var r=this;return e.history.route(t,function(i){var a=r._extractParameters(t,i);r.execute(n,a),r.trigger.apply(r,["route:"+s].concat(a)),r.trigger("route",s,a),e.history.trigger("route",r,s,a)}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=e.result(this,"routes");for(var t,s=i.keys(this.routes);null!=(t=s.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(O,"\\$&").replace(S,"(?:$1)?").replace(k,function(t,e){return e?t:"([^/?]+)"}).replace(I,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var s=t.exec(e).slice(1);return i.map(s,function(t,e){return e===s.length-1?t||null:t?decodeURIComponent(t):null})}});var A=e.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},T=/^[#\/]|\s+$/g,N=/^\/+|\/+$/g,C=/msie [\w.]+/,$=/\/$/,D=/#.*$/;A.started=!1,i.extend(A.prototype,o,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace($,"");t.indexOf(i)||(t=t.slice(i.length))}else t=this.getHash();return t.replace(T,"")},start:function(t){if(A.started)throw new Error("BbaseBackbone.history has already been started");A.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var s=this.getFragment(),n=document.documentMode,r=C.exec(navigator.userAgent.toLowerCase())&&(!n||7>=n);if(this.root=("/"+this.root+"/").replace(N,"/"),r&&this._wantsHashChange){var a=e.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=a.hide().appendTo("body")[0].contentWindow,this.navigate(s)}this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=s;var o=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&o.hash&&(this.fragment=this.getHash().replace(T,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),A.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(t){return t=this.fragment=this.getFragment(t),i.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(t,e){if(!A.started)return!1;e&&e!==!0||(e={trigger:!!e});var i=this.root+(t=this.getFragment(t||""));if(t=t.replace(D,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var s=t.href.replace(/(javascript:|#).*$/,"");t.replace(s+"#"+e)}else t.hash="#"+e}}),e.history=new A;var P=function(t){return"object"===!i.typeOf(t)?t:(i.each(a.call(arguments,1),function(e){for(var i in e)t[i]=e[i]}),t)},F=function(t,e){var s,n=this;s=t&&i.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},P(s,n,e);var r=function(){this.constructor=s};return r.prototype=n.prototype,s.prototype=new r,t&&i.extend(s.prototype,t),s.__super__=n.prototype,s};p.extend=f.extend=x.extend=v.extend=A.extend=F;var L=function(){throw new Error('A "url" property or function must be specified')},V=function(t,e){var i=e.error;e.error=function(s){i&&i(t,s,e),t.trigger("error",t,s,e)}};return e});var n={};!function(t,e){t.VERSION="1.0.0",t.COMPILER_REVISION=4,t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},t.helpers={},t.partials={};var i=Object.prototype.toString,s="[object Function]",n="[object Object]";t.registerHelper=function(e,s,r){if(i.call(e)===n){if(r||s)throw new t.Exception("Arg not supported with multiple helpers");t.Utils.extend(this.helpers,e)}else r&&(s.not=r),this.helpers[e]=s},t.registerPartial=function(e,s){i.call(e)===n?t.Utils.extend(this.partials,e):this.partials[e]=s},t.registerHelper("helperMissing",function(t){if(2===arguments.length)return e;throw new Error("Missing helper: '"+t+"'")}),t.registerHelper("blockHelperMissing",function(e,n){var r=n.inverse||function(){},a=n.fn,o=i.call(e);return o===s&&(e=e.call(this)),e===!0?a(this):e===!1||null==e?r(this):"[object Array]"===o?e.length>0?t.helpers.each(e,n):r(this):a(e)}),t.K=function(){},t.createFrame=Object.create||function(e){t.K.prototype=e;var i=new t.K;return t.K.prototype=null,i},t.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(e,i){if(t.logger.level<=e){var s=t.logger.methodMap[e];"undefined"!=typeof console&&console[s]&&console[s].call(console,i)}}},t.log=function(e,i){t.logger.log(e,i)},t.registerHelper("each",function(e,n){var r,a=n.fn,o=n.inverse,h=0,l="",c=i.call(e);if(c===s&&(e=e.call(this)),n.data&&(r=t.createFrame(n.data)),e&&"object"==typeof e)if(e instanceof Array)for(var u=e.length;u>h;h++)r&&(r.index=h),l+=a(e[h],{data:r});else for(var p in e)e.hasOwnProperty(p)&&(r&&(r.key=p),l+=a(e[p],{data:r}),h++);return 0===h&&(l=o(this)),l}),t.registerHelper("if",function(e,n){var r=i.call(e);return r===s&&(e=e.call(this)),!e||t.Utils.isEmpty(e)?n.inverse(this):n.fn(this)}),t.registerHelper("unless",function(e,i){return t.helpers["if"].call(this,e,{fn:i.inverse,inverse:i.fn})}),t.registerHelper("with",function(e,n){var r=i.call(e);return r===s&&(e=e.call(this)),t.Utils.isEmpty(e)?void 0:n.fn(e)}),t.registerHelper("log",function(e,i){var s=i.data&&null!=i.data.level?parseInt(i.data.level,10):1;t.log(s,e)});var r=function(){function t(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,simpleInverse:6,statements:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,params:27,hash:28,dataName:29,param:30,STRING:31,INTEGER:32,BOOLEAN:33,hashSegments:34,hashSegment:35,ID:36,EQUALS:37,DATA:38,pathSegments:39,SEP:40,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",31:"STRING",32:"INTEGER",33:"BOOLEAN",36:"ID",37:"EQUALS",38:"DATA",40:"SEP"},productions_:[0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[27,2],[27,1],[30,1],[30,1],[30,1],[30,1],[30,1],[28,1],[34,2],[34,1],[35,3],[35,3],[35,3],[35,3],[35,3],[26,1],[26,1],[26,1],[29,2],[21,1],[39,3],[39,1]],performAction:function(t,e,i,s,n,r){var a=r.length-1;switch(n){case 1:return r[a-1];case 2:this.$=new s.ProgramNode([],r[a]);break;case 3:this.$=new s.ProgramNode(r[a-2],r[a]);break;case 4:this.$=new s.ProgramNode(r[a-1],[]);break;case 5:this.$=new s.ProgramNode(r[a]);break;case 6:this.$=new s.ProgramNode([],[]);break;case 7:this.$=new s.ProgramNode([]);break;case 8:this.$=[r[a]];break;case 9:r[a-1].push(r[a]),this.$=r[a-1];break;case 10:this.$=new s.BlockNode(r[a-2],r[a-1].inverse,r[a-1],r[a]);break;case 11:this.$=new s.BlockNode(r[a-2],r[a-1],r[a-1].inverse,r[a]);break;case 12:this.$=r[a];break;case 13:this.$=r[a];break;case 14:this.$=new s.ContentNode(r[a]);break;case 15:this.$=new s.CommentNode(r[a]);break;case 16:this.$=new s.MustacheNode(r[a-1][0],r[a-1][1]);break;case 17:this.$=new s.MustacheNode(r[a-1][0],r[a-1][1]);break;case 18:this.$=r[a-1];break;case 19:this.$=new s.MustacheNode(r[a-1][0],r[a-1][1],"&"===r[a-2][2]);break;case 20:this.$=new s.MustacheNode(r[a-1][0],r[a-1][1],!0);break;case 21:this.$=new s.PartialNode(r[a-1]);break;case 22:this.$=new s.PartialNode(r[a-2],r[a-1]);break;case 23:break;case 24:this.$=[[r[a-2]].concat(r[a-1]),r[a]];break;case 25:this.$=[[r[a-1]].concat(r[a]),null];break;case 26:this.$=[[r[a-1]],r[a]];break;case 27:this.$=[[r[a]],null];break;case 28:this.$=[[r[a]],null];break;case 29:r[a-1].push(r[a]),this.$=r[a-1];break;case 30:this.$=[r[a]];break;case 31:this.$=r[a];break;case 32:this.$=new s.StringNode(r[a]);break;case 33:this.$=new s.IntegerNode(r[a]);break;case 34:this.$=new s.BooleanNode(r[a]);break;case 35:this.$=r[a];break;case 36:this.$=new s.HashNode(r[a]);break;case 37:r[a-1].push(r[a]),this.$=r[a-1];break;case 38:this.$=[r[a]];break;case 39:this.$=[r[a-2],r[a]];break;case 40:this.$=[r[a-2],new s.StringNode(r[a])];break;case 41:this.$=[r[a-2],new s.IntegerNode(r[a])];break;case 42:this.$=[r[a-2],new s.BooleanNode(r[a])];break;case 43:this.$=[r[a-2],r[a]];break;case 44:this.$=new s.PartialNameNode(r[a]);break;case 45:this.$=new s.PartialNameNode(new s.StringNode(r[a]));break;case 46:this.$=new s.PartialNameNode(new s.IntegerNode(r[a]));break;case 47:this.$=new s.DataNode(r[a]);break;case 48:this.$=new s.IdNode(r[a]);break;case 49:r[a-2].push({part:r[a],separator:r[a-1]}),this.$=r[a-2];break;case 50:this.$=[{part:r[a]}]}},table:[{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],25:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],25:[1,16]},{5:[2,5],6:20,8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],25:[1,16]},{17:23,18:[1,22],21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],25:[2,8]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{4:30,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{17:31,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:32,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:33,21:24,29:25,36:[1,28],38:[1,27],39:26},{21:35,26:34,31:[1,36],32:[1,37],36:[1,28],39:26},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],25:[1,16]},{17:23,21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,4],7:38,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],25:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{18:[1,39]},{18:[2,27],21:44,24:[2,27],27:40,28:41,29:48,30:42,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,28],24:[2,28]},{18:[2,48],24:[2,48],31:[2,48],32:[2,48],33:[2,48],36:[2,48],38:[2,48],40:[1,51]},{21:52,36:[1,28],39:26},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],38:[2,50],40:[2,50]},{10:53,20:[1,54]},{10:55,20:[1,54]},{18:[1,56]},{18:[1,57]},{24:[1,58]},{18:[1,59],21:60,36:[1,28],39:26},{18:[2,44],36:[2,44]},{18:[2,45],36:[2,45]},{18:[2,46],36:[2,46]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],25:[1,16]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{18:[2,25],21:44,24:[2,25],28:61,29:48,30:62,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,26],24:[2,26]},{18:[2,30],24:[2,30],31:[2,30],32:[2,30],33:[2,30],36:[2,30],38:[2,30]},{18:[2,36],24:[2,36],35:63,36:[1,64]},{18:[2,31],24:[2,31],31:[2,31],32:[2,31],33:[2,31],36:[2,31],38:[2,31]},{18:[2,32],24:[2,32],31:[2,32],32:[2,32],33:[2,32],36:[2,32],38:[2,32]},{18:[2,33],24:[2,33],31:[2,33],32:[2,33],33:[2,33],36:[2,33],38:[2,33]},{18:[2,34],24:[2,34],31:[2,34],32:[2,34],33:[2,34],36:[2,34],38:[2,34]},{18:[2,35],24:[2,35],31:[2,35],32:[2,35],33:[2,35],36:[2,35],38:[2,35]},{18:[2,38],24:[2,38],36:[2,38]},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],37:[1,65],38:[2,50],40:[2,50]},{36:[1,66]},{18:[2,47],24:[2,47],31:[2,47],32:[2,47],33:[2,47],36:[2,47],38:[2,47]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{21:67,36:[1,28],39:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,68]},{18:[2,24],24:[2,24]},{18:[2,29],24:[2,29],31:[2,29],32:[2,29],33:[2,29],36:[2,29],38:[2,29]},{18:[2,37],24:[2,37],36:[2,37]},{37:[1,65]},{21:69,29:73,31:[1,70],32:[1,71],33:[1,72],36:[1,28],38:[1,27],39:26},{18:[2,49],24:[2,49],31:[2,49],32:[2,49],33:[2,49],36:[2,49],38:[2,49],40:[2,49]},{18:[1,74]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{18:[2,39],24:[2,39],36:[2,39]},{18:[2,40],24:[2,40],36:[2,40]},{18:[2,41],24:[2,41],36:[2,41]},{18:[2,42],24:[2,42],36:[2,42]},{18:[2,43],24:[2,43],36:[2,43]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]}],defaultActions:{17:[2,1]},parseError:function(t){throw new Error(t)},parse:function(t){function e(){var t;return t=i.lexer.lex()||1,"number"!=typeof t&&(t=i.symbols_[t]||t),t}var i=this,s=[0],n=[null],r=[],a=this.table,o="",h=0,l=0,c=0;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;r.push(u);var p=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var d,f,g,m,_,b,v,y,E,w={};;){if(g=s[s.length-1],this.defaultActions[g]?m=this.defaultActions[g]:((null===d||"undefined"==typeof d)&&(d=e()),m=a[g]&&a[g][d]),"undefined"==typeof m||!m.length||!m[0]){var B="";if(!c){E=[];for(b in a[g])this.terminals_[b]&&b>2&&E.push("'"+this.terminals_[b]+"'");B=this.lexer.showPosition?"Parse error on line "+(h+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+E.join(", ")+", got '"+(this.terminals_[d]||d)+"'":"Parse error on line "+(h+1)+": Unexpected "+(1==d?"end of input":"'"+(this.terminals_[d]||d)+"'"),this.parseError(B,{text:this.lexer.match,token:this.terminals_[d]||d,line:this.lexer.yylineno,loc:u,expected:E})}}if(m[0]instanceof Array&&m.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+d);switch(m[0]){case 1:s.push(d),n.push(this.lexer.yytext),r.push(this.lexer.yylloc),s.push(m[1]),d=null,f?(d=f,f=null):(l=this.lexer.yyleng,o=this.lexer.yytext,h=this.lexer.yylineno,u=this.lexer.yylloc,c>0&&c--);break;case 2:if(v=this.productions_[m[1]][1],w.$=n[n.length-v],w._$={first_line:r[r.length-(v||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(v||1)].first_column,last_column:r[r.length-1].last_column},p&&(w._$.range=[r[r.length-(v||1)].range[0],r[r.length-1].range[1]]),_=this.performAction.call(w,o,l,h,this.yy,m[1],n,r),"undefined"!=typeof _)return _;v&&(s=s.slice(0,-1*v*2),n=n.slice(0,-1*v),r=r.slice(0,-1*v)),s.push(this.productions_[m[1]][0]),n.push(w.$),r.push(w._$),y=a[s[s.length-2]][s[s.length-1]],s.push(y);break;case 3:return!0}}return!0}},i=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);return e?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e-1),this.offset-=e;var s=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var n=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===s.length?this.yylloc.first_column:0)+s[s.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-e]),this},more:function(){return this._more=!0,this},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,i,s,n;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),a=0;a<r.length&&(i=this._input.match(this.rules[r[a]]),!i||e&&!(i[0].length>e[0].length)||(e=i,s=a,this.options.flex));a++);return e?(n=e[0].match(/(?:\r\n?|\n).*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],t=this.performAction.call(this,this.yy,this,r[s],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),t?t:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return"undefined"!=typeof t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()
},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return t.options={},t.performAction=function(t,e,i,s){switch(i){case 0:return e.yytext="\\",14;case 1:if("\\"!==e.yytext.slice(-1)&&this.begin("mu"),"\\"===e.yytext.slice(-1)&&(e.yytext=e.yytext.substr(0,e.yyleng-1),this.begin("emu")),e.yytext)return 14;break;case 2:return 14;case 3:return"\\"!==e.yytext.slice(-1)&&this.popState(),"\\"===e.yytext.slice(-1)&&(e.yytext=e.yytext.substr(0,e.yyleng-1)),14;case 4:return e.yytext=e.yytext.substr(0,e.yyleng-4),this.popState(),15;case 5:return 25;case 6:return 16;case 7:return 20;case 8:return 19;case 9:return 19;case 10:return 23;case 11:return 22;case 12:this.popState(),this.begin("com");break;case 13:return e.yytext=e.yytext.substr(3,e.yyleng-5),this.popState(),15;case 14:return 22;case 15:return 37;case 16:return 36;case 17:return 36;case 18:return 40;case 19:break;case 20:return this.popState(),24;case 21:return this.popState(),18;case 22:return e.yytext=e.yytext.substr(1,e.yyleng-2).replace(/\\"/g,'"'),31;case 23:return e.yytext=e.yytext.substr(1,e.yyleng-2).replace(/\\'/g,"'"),31;case 24:return 38;case 25:return 33;case 26:return 33;case 27:return 32;case 28:return 36;case 29:return e.yytext=e.yytext.substr(1,e.yyleng-2),36;case 30:return"INVALID";case 31:return 5}},t.rules=[/^(?:\\\\(?=(\{\{)))/,/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[}\/ ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:-?[0-9]+(?=[}\s]))/,/^(?:[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],t.conditions={mu:{rules:[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],inclusive:!1},emu:{rules:[3],inclusive:!1},com:{rules:[4],inclusive:!1},INITIAL:{rules:[0,1,2,31],inclusive:!0}},t}();return e.lexer=i,t.prototype=e,e.Parser=t,new t}();t.Parser=r,t.parse=function(e){return e.constructor===t.AST.ProgramNode?e:(t.Parser.yy=t.AST,t.Parser.parse(e))},t.AST={},t.AST.ProgramNode=function(e,i){this.type="program",this.statements=e,i&&(this.inverse=new t.AST.ProgramNode(i))},t.AST.MustacheNode=function(t,e,i){this.type="mustache",this.escaped=!i,this.hash=e;var s=this.id=t[0],n=this.params=t.slice(1),r=this.eligibleHelper=s.isSimple;this.isHelper=r&&(n.length||e)},t.AST.PartialNode=function(t,e){this.type="partial",this.partialName=t,this.context=e},t.AST.BlockNode=function(e,i,s,n){var r=function(e,i){if(e.original!==i.original)throw new t.Exception(e.original+" doesn't match "+i.original)};r(e.id,n),this.type="block",this.mustache=e,this.program=i,this.inverse=s,this.inverse&&!this.program&&(this.isInverse=!0)},t.AST.ContentNode=function(t){this.type="content",this.string=t},t.AST.HashNode=function(t){this.type="hash",this.pairs=t},t.AST.IdNode=function(e){this.type="ID";for(var i="",s=[],n=0,r=0,a=e.length;a>r;r++){var o=e[r].part;if(i+=(e[r].separator||"")+o,".."===o||"."===o||"this"===o){if(s.length>0)throw new t.Exception("Invalid path: "+i);".."===o?n++:this.isScoped=!0}else s.push(o)}this.original=i,this.parts=s,this.string=s.join("."),this.depth=n,this.isSimple=1===e.length&&!this.isScoped&&0===n,this.stringModeValue=this.string},t.AST.PartialNameNode=function(t){this.type="PARTIAL_NAME",this.name=t.original},t.AST.DataNode=function(t){this.type="DATA",this.id=t},t.AST.StringNode=function(t){this.type="STRING",this.original=this.string=this.stringModeValue=t},t.AST.IntegerNode=function(t){this.type="INTEGER",this.original=this.integer=t,this.stringModeValue=Number(t)},t.AST.BooleanNode=function(t){this.type="BOOLEAN",this.bool=t,this.stringModeValue="true"===t},t.AST.CommentNode=function(t){this.type="comment",this.comment=t};var a=["description","fileName","lineNumber","message","name","number","stack"];t.Exception=function(){for(var t=Error.prototype.constructor.apply(this,arguments),e=0;e<a.length;e++)this[a[e]]=t[a[e]]},t.Exception.prototype=new Error,t.SafeString=function(t){this.string=t},t.SafeString.prototype.toString=function(){return this.string.toString()};var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},h=/[&<>"'`]/g,l=/[&<>"'`]/,c=function(t){return o[t]||"&amp;"};t.Utils={extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},escapeExpression:function(e){return e instanceof t.SafeString?e.toString():null==e||e===!1?"":(e=e.toString(),l.test(e)?e.replace(h,c):e)},isEmpty:function(t){return t||0===t?"[object Array]"===i.call(t)&&0===t.length?!0:!1:!0}};var u=t.Compiler=function(){},p=t.JavaScriptCompiler=function(){};u.prototype={compiler:u,disassemble:function(){for(var t,e,i,s=this.opcodes,n=[],r=0,a=s.length;a>r;r++)if(t=s[r],"DECLARE"===t.opcode)n.push("DECLARE "+t.name+"="+t.value);else{e=[];for(var o=0;o<t.args.length;o++)i=t.args[o],"string"==typeof i&&(i='"'+i.replace("\n","\\n")+'"'),e.push(i);n.push(t.opcode+" "+e.join(" "))}return n.join("\n")},equals:function(t){var e=this.opcodes.length;if(t.opcodes.length!==e)return!1;for(var i=0;e>i;i++){var s=this.opcodes[i],n=t.opcodes[i];if(s.opcode!==n.opcode||s.args.length!==n.args.length)return!1;for(var r=0;r<s.args.length;r++)if(s.args[r]!==n.args[r])return!1}if(e=this.children.length,t.children.length!==e)return!1;for(i=0;e>i;i++)if(!this.children[i].equals(t.children[i]))return!1;return!0},guid:0,compile:function(t,e){this.children=[],this.depths={list:[]},this.options=e;var i=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},i)for(var s in i)this.options.knownHelpers[s]=i[s];return this.program(t)},accept:function(t){return this[t.type](t)},program:function(t){var e,i=t.statements;this.opcodes=[];for(var s=0,n=i.length;n>s;s++)e=i[s],this[e.type](e);return this.isSimple=1===n,this.depths.list=this.depths.list.sort(function(t,e){return t-e}),this},compileProgram:function(t){var e,i=(new this.compiler).compile(t,this.options),s=this.guid++;this.usePartial=this.usePartial||i.usePartial,this.children[s]=i;for(var n=0,r=i.depths.list.length;r>n;n++)e=i.depths.list[n],2>e||this.addDepth(e-1);return s},block:function(t){var e=t.mustache,i=t.program,s=t.inverse;i&&(i=this.compileProgram(i)),s&&(s=this.compileProgram(s));var n=this.classifyMustache(e);"helper"===n?this.helperMustache(e,i,s):"simple"===n?(this.simpleMustache(e),this.opcode("pushProgram",i),this.opcode("pushProgram",s),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(e,i,s),this.opcode("pushProgram",i),this.opcode("pushProgram",s),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(t){var e,i,s=t.pairs;this.opcode("pushHash");for(var n=0,r=s.length;r>n;n++)e=s[n],i=e[1],this.options.stringParams?(i.depth&&this.addDepth(i.depth),this.opcode("getContext",i.depth||0),this.opcode("pushStringParam",i.stringModeValue,i.type)):this.accept(i),this.opcode("assignToHash",e[0]);this.opcode("popHash")},partial:function(t){var e=t.partialName;this.usePartial=!0,t.context?this.ID(t.context):this.opcode("push","depth0"),this.opcode("invokePartial",e.name),this.opcode("append")},content:function(t){this.opcode("appendContent",t.string)},mustache:function(t){var e=this.options,i=this.classifyMustache(t);"simple"===i?this.simpleMustache(t):"helper"===i?this.helperMustache(t):this.ambiguousMustache(t),this.opcode(t.escaped&&!e.noEscape?"appendEscaped":"append")},ambiguousMustache:function(t,e,i){var s=t.id,n=s.parts[0],r=null!=e||null!=i;this.opcode("getContext",s.depth),this.opcode("pushProgram",e),this.opcode("pushProgram",i),this.opcode("invokeAmbiguous",n,r)},simpleMustache:function(t){var e=t.id;"DATA"===e.type?this.DATA(e):e.parts.length?this.ID(e):(this.addDepth(e.depth),this.opcode("getContext",e.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(t,e,i){var s=this.setupFullMustacheParams(t,e,i),n=t.id.parts[0];if(this.options.knownHelpers[n])this.opcode("invokeKnownHelper",s.length,n);else{if(this.options.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+n);this.opcode("invokeHelper",s.length,n)}},ID:function(t){this.addDepth(t.depth),this.opcode("getContext",t.depth);var e=t.parts[0];e?this.opcode("lookupOnContext",t.parts[0]):this.opcode("pushContext");for(var i=1,s=t.parts.length;s>i;i++)this.opcode("lookup",t.parts[i])},DATA:function(e){if(this.options.data=!0,e.id.isScoped||e.id.depth)throw new t.Exception("Scoped data references are not supported: "+e.original);this.opcode("lookupData");for(var i=e.id.parts,s=0,n=i.length;n>s;s++)this.opcode("lookup",i[s])},STRING:function(t){this.opcode("pushString",t.string)},INTEGER:function(t){this.opcode("pushLiteral",t.integer)},BOOLEAN:function(t){this.opcode("pushLiteral",t.bool)},comment:function(){},opcode:function(t){this.opcodes.push({opcode:t,args:[].slice.call(arguments,1)})},declare:function(t,e){this.opcodes.push({opcode:"DECLARE",name:t,value:e})},addDepth:function(t){if(isNaN(t))throw new Error("EWOT");0!==t&&(this.depths[t]||(this.depths[t]=!0,this.depths.list.push(t)))},classifyMustache:function(t){var e=t.isHelper,i=t.eligibleHelper,s=this.options;if(i&&!e){var n=t.id.parts[0];s.knownHelpers[n]?e=!0:s.knownHelpersOnly&&(i=!1)}return e?"helper":i?"ambiguous":"simple"},pushParams:function(t){for(var e,i=t.length;i--;)e=t[i],this.options.stringParams?(e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",e.stringModeValue,e.type)):this[e.type](e)},setupMustacheParams:function(t){var e=t.params;return this.pushParams(e),t.hash?this.hash(t.hash):this.opcode("emptyHash"),e},setupFullMustacheParams:function(t,e,i){var s=t.params;return this.pushParams(s),this.opcode("pushProgram",e),this.opcode("pushProgram",i),t.hash?this.hash(t.hash):this.opcode("emptyHash"),s}};var d=function(t){this.value=t};p.prototype={nameLookup:function(t,e){return/^[0-9]+$/.test(e)?t+"["+e+"]":p.isValidJavaScriptVariableName(e)?t+"."+e:t+"['"+e+"']"},appendToBuffer:function(t){return this.environment.isSimple?"return "+t+";":{appendToBuffer:!0,content:t,toString:function(){return"buffer += "+t+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"BbaseHandlebars",compile:function(e,i,s,n){this.environment=e,this.options=i||{},t.log(t.logger.DEBUG,this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!s,this.context=s||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(e,i);var r,a=e.opcodes;for(this.i=0,_=a.length;this.i<_;this.i++)r=a[this.i],"DECLARE"===r.opcode?this[r.name]=r.value:this[r.opcode].apply(this,r.args);return this.createFunctionContext(n)},nextOpcode:function(){var t=this.environment.opcodes;return t[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var t=[];if(this.isChild)t.push("");else{var e=this.namespace,i="helpers = this.merge(helpers, "+e+".helpers);";this.environment.usePartial&&(i=i+" partials = this.merge(partials, "+e+".partials);"),this.options.data&&(i+=" data = data || {};"),t.push(i)}t.push(this.environment.isSimple?"":", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=t},createFunctionContext:function(e){var i=this.stackVars.concat(this.registers.list);if(i.length>0&&(this.source[1]=this.source[1]+", "+i.join(", ")),!this.isChild)for(var s in this.context.aliases)this.context.aliases.hasOwnProperty(s)&&(this.source[1]=this.source[1]+", "+s+"="+this.context.aliases[s]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var n=this.isChild?["depth0","data"]:["BbaseHandlebars","depth0","helpers","partials","data"],r=0,a=this.environment.depths.list.length;a>r;r++)n.push("depth"+this.environment.depths.list[r]);var o=this.mergeSource();if(!this.isChild){var h=t.COMPILER_REVISION,l=t.REVISION_CHANGES[h];o="this.compilerInfo = ["+h+",'"+l+"'];\n"+o}if(e)return n.push(o),Function.apply(this,n);var c="function "+(this.name||"")+"("+n.join(",")+") {\n  "+o+"}";return t.log(t.logger.DEBUG,c+"\n\n"),c},mergeSource:function(){for(var t,i="",s=0,n=this.source.length;n>s;s++){var r=this.source[s];r.appendToBuffer?t=t?t+"\n    + "+r.content:r.content:(t&&(i+="buffer += "+t+";\n  ",t=e),i+=r+"\n  ")}return i},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=["depth0"];this.setupParams(0,t),this.replaceStack(function(e){return t.splice(1,0,e),"blockHelperMissing.call("+t.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=["depth0"];this.setupParams(0,t);var e=this.topStack();t.splice(1,0,e),t[t.length-1]="options",this.source.push("if (!"+this.lastHelper+") { "+e+" = blockHelperMissing.call("+t.join(", ")+"); }")},appendContent:function(t){this.source.push(this.appendToBuffer(this.quotedString(t)))},append:function(){this.flushInline();var t=this.popStack();this.source.push("if("+t+" || "+t+" === 0) { "+this.appendToBuffer(t)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(t){this.lastContext!==t&&(this.lastContext=t)},lookupOnContext:function(t){this.push(this.nameLookup("depth"+this.lastContext,t,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(t){return"typeof "+t+" === functionType ? "+t+".apply(depth0) : "+t})},lookup:function(t){this.replaceStack(function(e){return e+" == null || "+e+" === false ? "+e+" : "+this.nameLookup(e,t,"context")})},lookupData:function(){this.push("data")},pushStringParam:function(t,e){this.pushStackLiteral("depth"+this.lastContext),this.pushString(e),"string"==typeof t?this.pushString(t):this.pushStackLiteral(t)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.register("hashTypes","{}"),this.register("hashContexts","{}"))},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var t=this.hash;this.hash=e,this.options.stringParams&&(this.register("hashContexts","{"+t.contexts.join(",")+"}"),this.register("hashTypes","{"+t.types.join(",")+"}")),this.push("{\n    "+t.values.join(",\n    ")+"\n  }")},pushString:function(t){this.pushStackLiteral(this.quotedString(t))},push:function(t){return this.inlineStack.push(t),t},pushLiteral:function(t){this.pushStackLiteral(t)},pushProgram:function(t){this.pushStackLiteral(null!=t?this.programExpression(t):null)},invokeHelper:function(t,e){this.context.aliases.helperMissing="helpers.helperMissing";var i=this.lastHelper=this.setupHelper(t,e,!0),s=this.nameLookup("depth"+this.lastContext,e,"context");this.push(i.name+" || "+s),this.replaceStack(function(t){return t+" ? "+t+".call("+i.callParams+") : helperMissing.call("+i.helperMissingParams+")"})},invokeKnownHelper:function(t,e){var i=this.setupHelper(t,e);this.push(i.name+".call("+i.callParams+")")},invokeAmbiguous:function(t,e){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var i=this.setupHelper(0,t,e),s=this.lastHelper=this.nameLookup("helpers",t,"helper"),n=this.nameLookup("depth"+this.lastContext,t,"context"),r=this.nextStack();this.source.push("if ("+r+" = "+s+") { "+r+" = "+r+".call("+i.callParams+"); }"),this.source.push("else { "+r+" = "+n+"; "+r+" = typeof "+r+" === functionType ? "+r+".apply(depth0) : "+r+"; }")},invokePartial:function(t){var e=[this.nameLookup("partials",t,"partial"),"'"+t+"'",this.popStack(),"helpers","partials"];this.options.data&&e.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+e.join(", ")+")")},assignToHash:function(t){var e,i,s=this.popStack();this.options.stringParams&&(i=this.popStack(),e=this.popStack());var n=this.hash;e&&n.contexts.push("'"+t+"': "+e),i&&n.types.push("'"+t+"': "+i),n.values.push("'"+t+"': ("+s+")")},compiler:p,compileChildren:function(t,e){for(var i,s,n=t.children,r=0,a=n.length;a>r;r++){i=n[r],s=new this.compiler;var o=this.matchExistingProgram(i);null==o?(this.context.programs.push(""),o=this.context.programs.length,i.index=o,i.name="program"+o,this.context.programs[o]=s.compile(i,e,this.context),this.context.environments[o]=i):(i.index=o,i.name="program"+o)}},matchExistingProgram:function(t){for(var e=0,i=this.context.environments.length;i>e;e++){var s=this.context.environments[e];if(s&&s.equals(t))return e}},programExpression:function(t){if(this.context.aliases.self="this",null==t)return"self.noop";for(var e,i=this.environment.children[t],s=i.depths.list,n=[i.index,i.name,"data"],r=0,a=s.length;a>r;r++)e=s[r],n.push(1===e?"depth0":"depth"+(e-1));return(0===s.length?"self.program(":"self.programWithDepth(")+n.join(", ")+")"},register:function(t,e){this.useRegister(t),this.source.push(t+" = "+e+";")},useRegister:function(t){this.registers[t]||(this.registers[t]=!0,this.registers.list.push(t))},pushStackLiteral:function(t){return this.push(new d(t))},pushStack:function(t){this.flushInline();var e=this.incrStack();return t&&this.source.push(e+" = "+t+";"),this.compileStack.push(e),e},replaceStack:function(t){var e,i="",s=this.isInline();if(s){var n=this.popStack(!0);if(n instanceof d)e=n.value;else{var r=this.stackSlot?this.topStackName():this.incrStack();i="("+this.push(r)+" = "+n+"),",e=this.topStack()}}else e=this.topStack();var a=t.call(this,e);return s?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+i+a+")")):(/^stack/.test(e)||(e=this.nextStack()),this.source.push(e+" = ("+i+a+");")),e},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var t=this.inlineStack;if(t.length){this.inlineStack=[];for(var e=0,i=t.length;i>e;e++){var s=t[e];s instanceof d?this.compileStack.push(s):this.pushStack(s)}}},isInline:function(){return this.inlineStack.length},popStack:function(t){var e=this.isInline(),i=(e?this.inlineStack:this.compileStack).pop();return!t&&i instanceof d?i.value:(e||this.stackSlot--,i)},topStack:function(t){var e=this.isInline()?this.inlineStack:this.compileStack,i=e[e.length-1];return!t&&i instanceof d?i.value:i},quotedString:function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(t,e,i){var s=[];this.setupParams(t,s,i);var n=this.nameLookup("helpers",e,"helper");return{params:s,name:n,callParams:["depth0"].concat(s).join(", "),helperMissingParams:i&&["depth0",this.quotedString(e)].concat(s).join(", ")}},setupParams:function(t,e,i){var s,n,r,a=[],o=[],h=[];a.push("hash:"+this.popStack()),n=this.popStack(),r=this.popStack(),(r||n)&&(r||(this.context.aliases.self="this",r="self.noop"),n||(this.context.aliases.self="this",n="self.noop"),a.push("inverse:"+n),a.push("fn:"+r));for(var l=0;t>l;l++)s=this.popStack(),e.push(s),this.options.stringParams&&(h.push(this.popStack()),o.push(this.popStack()));return this.options.stringParams&&(a.push("contexts:["+o.join(",")+"]"),a.push("types:["+h.join(",")+"]"),a.push("hashContexts:hashContexts"),a.push("hashTypes:hashTypes")),this.options.data&&a.push("data:data"),a="{"+a.join(",")+"}",i?(this.register("options",a),e.push("options")):e.push(a),e.join(", ")}};for(var f="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),g=p.RESERVED_WORDS={},m=0,_=f.length;_>m;m++)g[f[m]]=!0;p.isValidJavaScriptVariableName=function(t){return!p.RESERVED_WORDS[t]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(t)?!0:!1},t.precompile=function(e,i){if(null==e||"string"!=typeof e&&e.constructor!==t.AST.ProgramNode)throw new t.Exception("You must pass a string or BbaseHandlebars AST to BbaseHandlebars.precompile. You passed "+e);i=i||{},"data"in i||(i.data=!0);var s=t.parse(e),n=(new u).compile(s,i);return(new p).compile(n,i)},t.compile=function(i,s){function n(){var n=t.parse(i),r=(new u).compile(n,s),a=(new p).compile(r,s,e,!0);return t.template(a)}if(null==i||"string"!=typeof i&&i.constructor!==t.AST.ProgramNode)throw new t.Exception("You must pass a string or BbaseHandlebars AST to BbaseHandlebars.compile. You passed "+i);s=s||{},"data"in s||(s.data=!0);var r;return function(t,e){return r||(r=n()),r.call(this,t,e)}},t.VM={template:function(e){var i={escapeExpression:t.Utils.escapeExpression,invokePartial:t.VM.invokePartial,programs:[],program:function(e,i,s){var n=this.programs[e];return s?n=t.VM.program(e,i,s):n||(n=this.programs[e]=t.VM.program(e,i)),n},merge:function(e,i){var s=e||i;return e&&i&&(s={},t.Utils.extend(s,i),t.Utils.extend(s,e)),s},programWithDepth:t.VM.programWithDepth,noop:t.VM.noop,compilerInfo:null};return function(s,n){n=n||{};var r=e.call(i,t,s,n.helpers,n.partials,n.data),a=i.compilerInfo||[],o=a[0]||1,h=t.COMPILER_REVISION;if(o!==h){if(h>o){var l=t.REVISION_CHANGES[h],c=t.REVISION_CHANGES[o];throw"Template was precompiled with an older version of BbaseHandlebars than the current runtime. Please update your precompiler to a newer version ("+l+") or downgrade your runtime to an older version ("+c+")."}throw"Template was precompiled with a newer version of BbaseHandlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+")."}return r}},programWithDepth:function(t,e,i){var s=Array.prototype.slice.call(arguments,3),n=function(t,n){return n=n||{},e.apply(this,[t,n.data||i].concat(s))};return n.program=t,n.depth=s.length,n},program:function(t,e,i){var s=function(t,s){return s=s||{},e(t,s.data||i)};return s.program=t,s.depth=0,s},noop:function(){return""},invokePartial:function(i,s,n,r,a,o){var h={helpers:r,partials:a,data:o};if(i===e)throw new t.Exception("The partial "+s+" could not be found");if(i instanceof Function)return i(n,h);if(t.compile)return a[s]=t.compile(i,{data:o!==e}),a[s](n,h);throw new t.Exception("The partial "+s+" could not be compiled when running in runtime-only mode")}},t.template=t.VM.template}(n),n.registerHelper("compare",function(t,e,i,s){if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");try{switch(e.toString()){case"==":return t==i?s.fn(this):s.inverse(this);case"!=":return t!=i?s.fn(this):s.inverse(this);case"===":return t===i?s.fn(this):s.inverse(this);case"!==":return t!==i?s.fn(this):s.inverse(this);case"<":return i>t?s.fn(this):s.inverse(this);case"<=":return i>=t?s.fn(this):s.inverse(this);case">":return t>i?s.fn(this):s.inverse(this);case">=":return t>=i?s.fn(this):s.inverse(this);case"&&":return t&&i?s.fn(this):s.inverse(this);case"||":return t||i?s.fn(this):s.inverse(this);case"indexOf":return t.indexOf(i)>-1?s.fn(this):s.inverse(this);default:return s.inverse(this)}}catch(n){console.log("Errow: hbs.compare v1="+t+";v2="+i+n)}}),n.registerHelper("pagination",function(t,e,i,s){var n="",s=s,i=i;3===arguments.length&&(s=i,i=9);for(var r=BbaseEst.getPaginationNumber(t,e,i),a=0,o=r.length;o>a;a++)n+=s.fn(r[a]);return n}),n.registerHelper("get",function(t){if("undefined"==typeof t||"string"!==BbaseEst.typeOf(t))return t;var e=t.split(".");return e[0]in this?e.length>1?("object"!==BbaseEst.typeOf(this[e[0]])&&(this[e[0]]=JSON.parse(this[e[0]])),BbaseEst.getValue(this,t)):this[e[0]]:void 0}),n.registerHelper("dateFormat",function(t,e){return BbaseEst.dateFormat(t,e)}),n.registerHelper("contains",function(t,e,i){return BbaseEst.isEmpty(t)?void 0:BbaseEst.contains(t,e)?i.fn(this):i.inverse(this)}),n.registerHelper("plus",function(t,e){return parseInt(t,10)+parseInt(e,10)}),n.registerHelper("minus",function(t,e){return parseInt(t,10)-parseInt(e,10)+""}),n.registerHelper("cutByte",function(t,e,i){return BbaseEst.cutByte(t,e,i.hash.end||"...")}),n.registerHelper("x",function(t){var e,i=function(){};try{i=Function.apply(this,["window","return "+t+";"])}catch(s){console.warn("[warning] {{x "+t+"}} is invalid javascript",s)}try{e=i.bind(this)(window)}catch(s){console.warn("[warning] {{x "+t+"}} runtime error",s)}return e}),n.registerHelper("xif",function(t,e){return n.helpers.x.apply(this,[t,e])?e.fn(this):e.inverse(this)}),n.registerHelper("If",function(t,e){var i=BbaseEst.compile("{{"+t.replace(/_quote_/gim,"'").replace(/&amp;/gim,"&")+"}}",this);return"true"===i||"1"===i?i=!0:"false"===i||"0"===i||""===i?i=!1:"string"!==BbaseEst.typeOf(i)||BbaseEst.isEmpty(i)||(i=!0),i?e.fn(this):e.inverse(this)}),n.registerHelper("parseInt",function(t){return parseInt(t,10)}),n.registerHelper("id2",function(t){return null==t?"":t.replace(/^[^1-9]+/,"")}),n.registerHelper("CONST",function(t){return BbaseEst.getValue(CONST,t)}),n.registerHelper("picUrl",function(t,e){var i=t;if(arguments.length<3)return t||CONST.PIC_NONE;if(null==t||0==t.length)return CONST.PIC_NONE;if(e>10)i=i+"!"+e;else{var s=i.substring(i.lastIndexOf(".")+1,i.length);i=i.substring(0,i.lastIndexOf("."))+"_"+e+"."+s}return i?i:""}),n.registerHelper("_picUrl",function(t,e,i){var s=CONST.PIC_URL;return i&&i.hash.domain&&(s=i.hash.domain),s+"/"+n.helpers.picUrl.apply(this,[t,e,i])}),n.registerHelper("PIC",function(t,e,i){var s="",i=i,r=CONST.PIC_NONE,a=CONST.PIC_URL;return arguments.length<3&&(i=e),i&&i.hash["default"]&&(r=i.hash["default"]),i&&i.hash.domain&&(a=i.hash.domain),t&&(t=t.replace(/\\/gim,"/"),s+=t.indexOf("?")>-1?"&v="+BbaseEst.hash(CONST.APP_VERSION):"?v="+BbaseEst.hash(CONST.APP_VERSION),BbaseEst.startsWidth(t,"CONST")&&(t=n.helpers.CONST.apply(this,[t.replace("CONST.",""),i]))),t&&/[^\s]+\.(?:jpe?g|gif|png|bmp)/i.test(t)?(-1===t.indexOf("upaiyun.com")&&BbaseEst.startsWidth(t,"http")&&t.indexOf("upload")>-1&&(t=t.substring(t.indexOf("upload"),t.length)),-1===t.indexOf("upaiyun.com")&&BbaseEst.startsWidth(t,"upload")?arguments.length<3?a+"/"+t+s:n.helpers._picUrl.apply(this,[t,e,i])+s:BbaseEst.startsWidth(t,"http")?t+s:CONST.DOMAIN+t+s):r.indexOf("http://")>-1?r:CONST.DOMAIN+r+s}),n.registerHelper("isEmpty",function(t,e){return BbaseEst.isEmpty(t)?e.fn(this):e.inverse(this)}),n.registerHelper("encodeUrl",function(t){return encodeURIComponent(t)}),n.registerHelper("json",function(t){return n.helpers.get.call(this,t)}),n.registerHelper("version",function(t){switch(t){case"time":return(new Date).getTime();case"hash":return BbaseEst.hash((new Date).getTime());default:return BbaseEst.hash((new Date).getTime())}}),n.registerHelper("stripScripts",function(t){return BbaseEst.stripScripts(t)}),n.registerHelper("replace",function(t,e,i){return BbaseEst.isEmpty(t)?t:t.replace(new RegExp(e,"img"),i)}),n.registerHelper("default",function(t,e){return BbaseEst.isEmpty(t)?e:t}),n.registerHelper("keyMap",function(t,e){return t&&e?e[t]:""}),n.registerHelper("pipe",function(t){var e,i=null,s="string",r=/\(([^:\$]*)\)/gim,a=BbaseEst.cloneDeep(this),o=t.split(";");return BbaseEst.each(o,function(t,o){if(t=BbaseEst.trim(t),!BbaseEst.isEmpty(t)){var h=[],l=null,c="",u=t.match(r);switch(u&&BbaseEst.each(u[0].split(","),function(t){var e=BbaseEst.trim(t.split(".")[0].replace(/[\(|\)]/gim,""));l||(l=e,0===o&&(s=BbaseEst.typeOf(BbaseEst.getValue(a,l)))),h.push(e.indexOf("'")>-1?e.replace(/'/gim,""):/^[\d\.]+$/gim.test(e)?parseFloat(e):BbaseEst.getValue(a,e))},this),c=BbaseEst.trim(t.replace(/\(.*\)/g,"")),n.helpers[c]?e=n.helpers[c].apply(a,h):BbaseApp.getFilter(c)?e=BbaseApp.getFilter(c).apply(a,h):(e=BbaseEst.compile("{{"+t+"}}",a),e.indexOf("NaN")>-1&&(e=e.replace(/NaN/gim,"")),e.indexOf("undefined")>-1&&(e=e.replace(/undefined/gim,"")),e.indexOf("null")>-1&&(e=e.replace(/null/gim,""))),BbaseEst.isEmpty(l)?l=i:i=l,s){case"string":e=String(e);break;case"number":/^[\d.]*$/.test(e)&&(e=Number(e));break;case"boolean":e=Boolean(e);break;default:e=String(e)}a[l]=e}},this),e});var r=function(t){this.options=t,BbaseEst.extend(this,t),this.initialize.apply(this,arguments)};BbaseEst.extend(r.prototype,{initialize:function(){this.data={itemActiveList:[],sessionId:""},this.instance={},this.modules={},this.routes={},this.templates={},this.panels={},this.dialog=[],this.dialogs={},this.status={},this.cookies=[],this.models=[],this.compileTemps={},this.filters={navigator:[],form:[]},this.cache={},this.directives={}},getAppType:function(){return"backbone"},addRegion:function(t,e,i){var s=BbaseEst.nextUid("region");return i.__panelId||(i.__panelId=i.el),i.diff&&app.getView(i.viewId||t)?(app.getView(i.viewId||t)._extend(i),void app.getView(i.viewId||t)._reset(i.data)):(this.addPanel(t,{el:i.__panelId,template:'<div class="region '+s+'"></div>',append:i.append},i),i.viewId||(i.viewId=t),i.viewId in this.instance&&this.removeView(i.viewId),this.addView(i.viewId,new e(i)))},addPanel:function(t,e,i){var s="string"===BbaseEst.typeOf(e.cid)?!1:!0;return i=i||{},a.addLoading(),s&&(this.removePanel(t,e),e.$template=$(e.template),i&&(i.el=e.$template),e.$template.addClass("__panel_"+t),e.$template.attr("data-view",i.viewId||t),e.append||$(e.el).empty(),$(e.el).append(e.$template)),this.panels[t]=e,s?this:e},removePanel:function(t,e){try{var i=[];e||(e=this.panels[t]),"body"!==e.el&&($(".region",$(e.el)).each(function(){i.push($(this).attr("data-view"))}),i.reverse(),BbaseEst.each(i,function(t){app.removeView(t)})),$(".__panel_"+t,$(e.el)).off().remove(),delete this.panels[t]}catch(s){console.error(s)}},addView:function(t,e){return t in this.instance&&this.removeView(t),this.instance[t]=e,e=e||{},e.options=e.options||{},e.options.viewId=e.options.viewId||t,this.setCurrentView(t),this.instance[t]},removeView:function(t){try{this.getView(t)&&(this.getView(t).destroy&&this.getView(t).destroy(),this.getView(t)._destroy&&this.getView(t)._destroy(),this.getView(t)._empty&&this.getView(t)._empty(),this.getView(t).stopListening&&this.getView(t).stopListening(),this.getView(t).$el&&this.getView(t).$el.off().remove()),delete this.instance[t]}catch(e){console.log(e)}return this},panel:function(t,e){return this.addPanel(t,e)},show:function(t){this.addView(this.currentView,t)},getPanel:function(t){return this.panels[t]},add:function(t,e){return this.addView(t,e)},setCurrentView:function(t){this.currentView=t},getCurrentView:function(){return this.currentView},getView:function(t){return this.instance[t]},addDialog:function(t,e){return this.dialog.push(t),e&&(app.addData("_curDialog",e),this.dialogs[e]=t),t},getDialogs:function(){return this.dialog},getDialog:function(t){return BbaseEst.isEmpty(t)?this.dialogs:this.dialogs[t]},getCurrentDialog:function(){return app.getData("_curDialog")?this.dialogs[app.getData("_curDialog")]:null},emptyDialog:function(){BbaseEst.each(this.dialog,function(t){t&&t.close&&t.close().remove()}),this.dialog=[],this.dialogs={},app.addData("_curDialog",null)},addModel:function(t){return this.models.push(t),t},getModels:function(){return this.models
},addData:function(t,e){this.data[t]=e},getData:function(t){return this.data[t]},addModule:function(t,e){t in this.modules&&console.log("module:"+t+" isExisted"),this.modules[t]=e},getModules:function(){return this.modules},addRoute:function(t,e){t in this.routes&&console.log("route:"+t+" isExisted"),this.routes[t]=e},getRoutes:function(){return this.routes},addTemplate:function(t,e){this.templates[t]=e},getTemplates:function(){return this.templates},addSession:function(t,e,i){try{var s="undefined"===BbaseEst.typeOf(i)?"":i?this.data.sessionId:"";localStorage["___JHW_BACKBONE__"+BbaseEst.hash(s+t)]=JSON.stringify(e)}catch(n){debug("Error9 -> addSession -> "+n)}return e},getSession:function(t,e){try{var i="undefined"===BbaseEst.typeOf(e)?"":e?this.data.sessionId:"";return JSON.parse(localStorage["___JHW_BACKBONE__"+BbaseEst.hash(i+t)])}catch(s){return app.addSession(t,""),""}},addCompileTemp:function(t,e){this.compileTemps[t]=e},getCompileTemp:function(t){return this.compileTemps[t]},addStatus:function(t,e){this.status[t]=e},getStatus:function(t){return this.status[t]},getAllStatus:function(){return this.status},addOption:function(t,e){this.options[t]=e},getOption:function(t){return BbaseEst.cloneDeep(this.options[t])},addFilter:function(t,e){"navigator"===t?this.filters[t].push(e):this.filters[t]=e},getFilter:function(t){return this.filters[t]},getFilters:function(t){return this.filters[t]},getParamsHash:function(t){var e="",i="";for(var s in t)e+=t[s];return i="_hash"+BbaseEst.hash(e)},addCache:function(t,e){try{var i="";if(!e.success)return;i=this.getParamsHash(t),t.session&&e?app.addSession(i,e):this.cache[i]=e}catch(s){debug("Error12 -> addCache -> "+s)}},getCache:function(t){var e=null,i=this.getParamsHash(t);return!t.session||app.getData("versionUpdated")?this.cache[i]:(e=app.getSession(i))?JSON.parse(e):void 0},removeCache:function(t){var e=null;return t?(e=this.getParamsHash(t),void delete this.cache[e]):void(this.cache={})},addCookie:function(t){-1===BbaseEst.findIndex(this.cookies,t)&&this.cookies.push(t)},getCookies:function(){return this.cookies},addDirective:function(t,e){this.directives[t]=e},getDirective:function(t){return this.directives[t]}}),window.BbaseApp=window.BbaseApp||new r({});var a={dialog:function(t){var e=t.button||[];seajs.use(["dialog-plus"],function(i){t.success&&e.push({value:CONST.LANG.CONFIRM,autofocus:!0,callback:function(){t.success.apply(this,arguments)}}),t.hideCloseBtn||e.push({value:CONST.LANG.CLOSE,callback:function(){this.close().remove()}}),t=BbaseEst.extend({id:t.id||t.moduleId||BbaseEst.nextUid("dialog"),title:CONST.LANG.DIALOG_TIP,width:150,content:"",button:e},t),t.target&&(t.target=$(t.target).get(0)),t.oniframeload=function(){try{this.iframeNode.contentWindow.topDialog=thisDialog,this.iframeNode.contentWindow.app=app,delete BbaseApp.getRoutes().index}catch(e){}"function"==typeof t.load&&t.load.call(this,arguments)},t.cover?BbaseApp.addDialog(i(t),t.viewId||t.dialogId).showModal(t.target):BbaseApp.addDialog(i(t),t.viewId||t.dialogId).show(t.target)})},tip:function(t,e){e=BbaseEst.extend({id:"tip-dialog"+BbaseEst.nextUid(),time:3e3,content:'<div style="padding: 10px;">'+t+"</div>",title:null},e),seajs.use(["dialog-plus"],function(t){window.tipsDialog&&window.tipsDialog.close().remove(),window.tipsDialog=BbaseApp.addDialog(t(e)).show(e.target),setTimeout(function(){window.tipsDialog.close().remove()},e.time)})},confirm:function(t,e){var i={title:CONST.LANG.WARM_TIP,content:CONST.LANG.DEL_CONFIRM,success:function(){},target:null};BbaseEst.extend(i,t),e||(e=this),seajs.use(["dialog-plus"],function(s){window.comfirmDialog=BbaseApp.addDialog(s({id:"dialog"+BbaseEst.nextUid(),title:i.title,content:'<div style="padding: 20px;">'+i.content+"</div>",width:i.width||200,button:[{value:t.successValue||CONST.LANG.CONFIRM,autofocus:!0,callback:function(){i.success&&i.success.call(e)}},{value:t.cancelValue||CONST.LANG.CANCEL,callback:function(){window.comfirmDialog.close().remove(),i.cancel&&i.cancel.call(e)}}],onClose:function(){i.cancel&&i.cancel.call(e)}})).show(i.target)})},addLoading:function(){try{window.$loading&&window.$loading.remove(),window.$loading=$('<div id="loading" class="loading"><div class="object" id="object_one"></div><div class="object" id="object_two"></div><div class="object" id="object_three"></div></div>'),$("body").append(window.$loading),window.$loading_timer&&clearTimeout(window.$loading_timer),window.$loading_timer=setTimeout(function(){a.removeLoading()},3e4)}catch(t){}return window.$loading},removeLoading:function(){window.$loading?window.$loading.remove():$(".loading").remove()},execute:function(t){return a[t]&&a[t].apply(a,[].slice.call(arguments,1))}},o=function(){return"object"==typeof o.instance?o.instance:void(o.instance=this)};o.prototype={ajax:function(t){var e=BbaseEst.extend({_method:"GET"},t);return $.ajax({type:"post",url:t.url,async:!1,cache:t.cache,data:e,success:function(){}})},initTree:function(t,e){t.tree&&(e.attributes.data=BbaseEst.bulidTreeNode(e.attributes.data,t.rootKey,t.rootValue,{categoryId:t.categoryId,belongId:t.belongId,childTag:t.childTag,sortBy:t.sortBy,callback:function(e){t.tree&&(e.text=e[t.text],e.value=e[t.value])}}))},initSelect:function(t,e){t.select&&(BbaseEst.each(e.attributes.data,function(e){e.text=e[t.text],e.value=e[t.value]}),t.tree&&(e.attributes.data=BbaseEst.bulidSelectNode(e.attributes.data,1,{name:"text"})))},initExtend:function(t,e){t.extend&&(e.attributes.data=BbaseEst.extendTree(e.attributes.data))},initDefault:function(t,e){e.attributes&&t.defaults&&"array"===BbaseEst.typeOf(e.attributes.data)&&e.attributes.data.unshift({text:CONST.LANG.SELECT_DEFAULT,value:t.defaultValue})},factory:function(t){var e=this,i=BbaseEst.promise,s="",n="",r=null,o=null;t=BbaseEst.extend({select:!1,extend:!1,defaults:!1,tree:!1,defaultValue:null,timeout:1e4,cache:!1,complete:function(t,e){a.removeLoading(),"timeout"==e&&(o.abort(),a.tip("服务器繁忙， 请稍后再试"))}},t);for(var h in t)s+=t[h];return n="_hash"+BbaseEst.hash(s),new i(t.session&&!BbaseApp.getData("versionUpdated")&&(r=BbaseApp.getSession(n))?function(t){t(JSON.parse(r))}:function(i){CONST.DEBUG_LOCALSERVICE?i([]):o=e.ajax(t).done(function(s){var r=null;return s&&"notLogin"===s.msgType&&BbaseEst.trigger("checkLogin"),"string"===BbaseEst.typeOf(s)?(t.session&&s.attributes&&BbaseApp.addSession(n,s),void i(s)):(s.attributes?(e.initTree(t,s),e.initSelect(t,s),e.initExtend(t,s)):(s.attributes=s.attributes||{},s.attributes.data=[]),e.initDefault(t,s),r=s.attributes?s.attributes.data:s,t.session&&s.attributes&&BbaseApp.addSession(n,r),void i(r))})})},query:function(t){var e=this,i=BbaseEst.promise,s="",n="",r=null,o=null;t=BbaseEst.extend({cache:!1,timeout:1e4,complete:function(t,e){a.removeLoading(),"timeout"==e&&(o.abort(),a.tip("服务器繁忙， 请稍后再试"))}},t);for(var h in t)s+=t[h];return n="_hash"+BbaseEst.hash(s),new i(t.session&&!BbaseApp.getData("versionUpdated")&&(r=BbaseApp.getSession(n))?function(t){t(JSON.parse(r))}:function(i){CONST.DEBUG_LOCALSERVICE?i([]):o=e.ajax(t).done(function(e){"notLogin"===e.msgType&&BbaseEst.trigger("checkLogin"),t.session&&e&&BbaseApp.addSession(n,e),i(e)})})}};var h=BbaseBackbone.View.extend({constructor:function(t){this.options=t||{},this._re_dup={},this._re_selector={},this._attr_list={},this._directives_=[],this._ready_component_=!1,this.init&&"function"!==BbaseEst.typeOf(this.init)&&this._initialize(this.init),BbaseBackbone.View.apply(this,arguments)},_super:function(t,e){if("object"===BbaseEst.typeOf(t))this._initialize(t);else{if(BbaseEst.isEmpty(t))return BbaseApp.getView(this.viewId);switch(t){case"data":return BbaseApp.getView(this.viewId).model.toJSON();case"view":return BbaseApp.getView(this.viewId);case"model":return BbaseApp.getView(this.viewId).model;case"options":return BbaseApp.getView(this.viewId)?BbaseApp.getView(this.viewId)._options:this._options.data;default:return BbaseApp.getView(this.viewId)&&BbaseApp.getView(this.viewId)[t]?(BbaseApp.getView(this.viewId)[t].timer&&clearTimeout(BbaseApp.getView(this.viewId)[t].timer),BbaseApp.getView(this.viewId)[t].timer=setTimeout(this._bind(function(){BbaseApp.getView(this.viewId)[t](e),BbaseApp.getView(this.viewId)[t].timer=null}),20)):this[t]&&this[t](e),this}}},initialize:function(){this._super("_initialize")},_extend:function(t){BbaseEst.extend(this.options,t)},_view:function(t){return BbaseApp.getView(t+this.cid)},_region:function(t,e,i){return 1===arguments.length?this._view(t):void BbaseApp.addRegion(t+this.cid,e,i)},_service:function(t,e){return Service[t](e)},_navigate:function(t,e){e=e||!0,"undefined"==typeof Backbone?BbaseBackbone.history.navigate(t,e):Backbone.history.navigate(t,e)},_singleBind:function(t,e,i,s){var n=this;$(e,t||this.$el).each(function(){var t=[],e=$(this).attr("bb-model"),i=$(this).attr("data-bind-type")||"change";BbaseEst.isEmpty(e)||(t=e.split(":"),i=t.length>1?t[1]:"change"),$(this).off(i).on(i,function(t){var e,i,r,a,o;if(37===t.keyCode||39===t.keyCode||38===t.keyCode||40===t.keyCode)return!1;if(r=$(this).attr("id"),o=$(this).attr("bb-model"),BbaseEst.isEmpty(o)||(o=o.split(":")[0]),o||r&&-1!==r.indexOf("model")){switch(this.type){case"radio":e=$(this).is(":checked")?$(this).val():i=!0;break;case"checkbox":e=$(this).is(":checked")?BbaseEst.isEmpty($(this).attr("true-value"))?!0:$(this).attr("true-value"):BbaseEst.isEmpty($(this).attr("false-value"))?!1:$(this).attr("false-value");break;default:e=$(this).val()}i||(a=o||r.replace(/^model\d?-(.+)$/g,"$1"),n._set(a,e),s&&s.call(n,a,t),n.update&&n.update.call(n,a))}})})},_modelBind:function(t,e,i){var s=this;e?this._singleBind(t,e,this.model,i):this.$("input, textarea, select").each(function(){s._singleBind(null,$(this),s.model,i)})},_getCompileTemp:function(t,e,i,s,r){var a=null,o="";switch(t){case"html":return o=this._parseHbs(e.html()),{compile:n.compile(o),compileStr:o};case"checked":return o="{{"+/bb-checked=\"(.*?)\"\s?/gim.exec(i)[1]+"}}",{compile:BbaseEst.compile(o),compileStr:o};case"show":return a=e.attr("bb-show").split(":"),a=a.length>1?a[1]:a[0],o="{{"+a+"}}",{compile:BbaseEst.compile(o),compileStr:o};default:return BbaseApp.getDirective(t)?(o=e.attr("bb-"+s),o=o||r,{compile:BbaseApp.getDirective(t).compile?BbaseApp.getDirective(t).compile:o.indexOf("{{")>-1?n.compile(o):BbaseEst.compile("{{"+o+"}}"),compileStr:i}):(a=this._parseHbs(e.attr(s)),!a&&e.is("textarea")&&(a=this._parseHbs(e.html())),o=BbaseEst.isEmpty(a)||-1===a.indexOf("{{")?"{{"+r+"}}":a,{compile:n.compile(o),compileStr:o,directive:"value"===s&&i.indexOf("bb-model")>-1?"model":s})}},_replaceNode:function(t,e,i,s,n){switch(t){case"value":e.is(":checkbox")&&("false"===i||"0"===i||BbaseEst.isEmpty(i)?e.prop("checked",!1):e.prop("checked",!0)),e.val(i);break;case"html":e.html(i);break;case"show":"false"===i||"0"===i||BbaseEst.isEmpty(i)?e.hide():e.show();break;case"checked":this._get(/bb-checked=\"(.*?)\"\s?/gim.exec(s)[1])?e.prop("checked",!0):e.prop("checked",!1);break;default:BbaseApp.getDirective(t)&&BbaseApp.getDirective(t).update?BbaseApp.getDirective(t).update.apply(this,[t,e,s,i]):e.attr(n,i)}},_handleReplace:function(t,e,i,s,n){var r="";r=t.compile(e.attributes),(!BbaseEst.isEmpty(t.directive)&&"model"===t.directive||t.result!==r)&&(t.node||(t.node=this.$(i).eq(t.index),0===t.node.size()&&(t.node=this.$(".directive_"+BbaseEst.hash(i)).eq(t.index))),this._replaceNode(s,t.node,r,i,n),t.result=r)},_getAttrList:function(t){var e=[],i=[],s=[],n=BbaseEst.hash(t);return n in this._attr_list?this._attr_list[n]:(t.indexOf("]:")>-1?(e=t.split("]:"),i=BbaseEst.map(e,function(t,i){return i!==e.length-1?t+"]":t}),s=i[1].split(":"),s.length>1&&(i.pop(),i=i.concat(s))):i=t.indexOf("://")>-1?[t]:t.split(":"),this._attr_list[n]=i,i)},_getSelectorSplit:function(t){var e=BbaseEst.hash(t);if(e in this._re_selector)return this._re_selector[e];var i=t.split(","),s=[],n="";return t.indexOf("[bb-watch=")>-1?BbaseEst.each(i,function(t){t.indexOf("[bb-")>-1&&-1===t.indexOf("]")?n=t:t.indexOf("]")>-1&&-1===t.indexOf("[bb-")?(n+=","+t,s.push(n)):t.indexOf("[bb-")>-1&&t.indexOf("]")>-1?s.push(t):-1===t.indexOf("[bb-")&&-1===t.indexOf("]")&&(n+=","+t)}):s=i,this._re_selector[e]=s,s},_viewReplace:function(t,e,i,s){try{this._re_dup||(this._re_dup={}),BbaseEst.each(this._getSelectorSplit(t),this._bind(function(t){var i=[],r="",a="",o="",h="",l="",c="";if(!BbaseEst.isEmpty(t))if(o=BbaseEst.hash(t),i=this._getAttrList(t),i.length>1)for(var u=1;u<i.length;u++)o=BbaseEst.hash(i[0]+i[u]),c=i[u],BbaseEst.msie()?(l="ng-"+i[u],this._re_dup[o]||(r=this._options.template.replace(new RegExp("\\s"+c+"=","img")," "+l+"="))):(l=c,r=this.$template),this._re_dup[o]||(this._re_dup[o]=[],h=$(r).find(i[0]),0===h.size()&&(h=this.$el.find(i[0])),$.each(h,$.proxy(function(t,e){this._re_dup[o].push(BbaseEst.extend(this._getCompileTemp(c,$(e),i[0],l,s),{hash:o+""+t,index:t}))},this))),BbaseEst.each(this._re_dup[o],function(t){this._handleReplace(t,e,i[0],c,l,s)},this);else{if(BbaseEst.msie()?(this["h_temp_"+o]||(r=this.$template.replace(new RegExp("\\sstyle=","img")," ng-style=")),this["h_temp_"+o]=this["h_temp_"+o]||n.compile($(r).find(t).wrapAll("<div>").parent().html().replace(/ng-style/gim,"style"))):this["h_temp_"+o]=this["h_temp_"+o]||n.compile($(this.$template).find(t).wrapAll("<div>").parent().html()),a=this["h_temp_"+o](e.attributes),this["h_temp_r_"+o]===a)return;this.$(t).replaceWith(a),this["h_temp_r_"+o]=a}})),i&&BbaseEst.each(i,function(t){t.call(this,s)},this)}catch(r){debug("Error -> _viewReplace -> "+r+"selector:"+t,{e:r})}},_watch:function(t,e,i){var s,n=this,r=null,a={},o=[];this.watchFields||(this.watchFields={}),this.cbMap||(this.cbMap={}),"array"===BbaseEst.typeOf(t)?o=t:o.push(t),BbaseEst.each(o,function(t){var o=t.replace(/^#?model\d?-(.+)$/g,"$1");i&&(this.cbMap[o]=this.cbMap[o]||[],"string"===BbaseEst.typeOf(i)?(r=BbaseEst.hash(o+i),r in this.cbMap||(this.cbMap[r]=!0,this.cbMap[o].push(this[i]))):this.cbMap[o].push(i)),o in this.watchFields?BbaseEst.each(this._getSelectorSplit(e),function(t){-1===this.watchFields[o].indexOf(t)&&(this.watchFields[o]=this.watchFields[o]+","+t)},this):this.watchFields[o]=e,e=this.watchFields[o],s=n.cid+o,s in a||(BbaseEst.off(a[s]=s).on(s,function(){n._viewReplace(e,n.model,n.cbMap[o],o),n.update&&n.update.call(n,o)}),n.model.off("change:"+(a[o]=o.split(".")[0])).on("change:"+a[o],function(){n._viewReplace(e,n.model,n.cbMap[o],o),n.update&&n.update.call(n,o)}))},this)},_watchBind:function(t){var e=[],i=[];this.cbMap={},this.watchFields={},"string"===BbaseEst.typeOf(t)&&(i=t.match(new RegExp('(bb-watch=\\"(.+?)"(\\s*)|bb-change=\\"(.+?)"(\\s*)|bb-model=\\"(.+?)"(\\s*))(bb-render=\\"(.+?)\\"\\s*)?(bb-change=\\"(.+?)\\"\\s*)?',"img")),BbaseEst.each(i,this._bind(function(t){var i="",s="",n="",r=[],a={},o="",h="";i=/bb-watch=\"(.*?)\"\s?/gim.exec(t)||"",h=/bb-render=\"(.*?)\"\s?/gim.exec(t)||"",n=/bb-change=\"(.*?)\"\s?/gim.exec(t)||"",s=/bb-model=\"(.*?)\"\s?/gim.exec(t)||"",BbaseEst.isEmpty(i)&&BbaseEst.isEmpty(s)||(i.length>1&&(i[1].indexOf(":")>-1?(a=this._getWatchRender(i,h),i=a.watch,h=a.render):(r=i[1].split(":"),o='[bb-watch="'+i[1]+'"]'+i[1].substring(i[1].indexOf(":"),i[1].length),r.length>1&&(h.length<1?h=["",o]:h[1]+=","+o),i[1]=r[0])),e.push({watch:i.length>1?i[1]:s[1].split(":")[0],render:h.length>1?h[1]:"",change:n.length>1?BbaseEst.trim(n[1].substring(0,-1===n[1].indexOf("(")?n[1].length:n[1].indexOf("("))):null}))}))),BbaseEst.each(e,this._bind(function(t){this._watch(t.watch.split(","),t.render,BbaseEst.isEmpty(t.change)?null:t.change)})),this.onWatch&&this.onWatch.call(this,arguments)},_getWatchRender:function(t,e){var i="",s="",n=t[1].split(",");return BbaseEst.each(n,function(e){var n=[];n=e.split(":"),s+=(BbaseEst.isEmpty(s)?"":",")+'[bb-watch="'+t[1]+'"]'+e.substring(e.indexOf(":"),e.length),i+=(BbaseEst.isEmpty(i)?"":",")+n[0]}),t[1]=i,e.length<1?e=["",s]:e[1]+=","+s,{watch:t,render:e}},_bbBind:function(t,e){var i,s,n,r={};if(this.bbList=[],"string"===BbaseEst.typeOf(t)){for(i=new RegExp('\\bbb-([\\w\\.]+)=\\"(.+?)\\"\\s?',"img");null!==(n=i.exec(t));)this.bbList.push({name:n[1],value:n[2]});BbaseEst.each(this.bbList,this._bind(function(t){if(s=BbaseEst.hash(t.name+t.value),!(s in r))switch(r[s]=t,t.name){case"watch":break;case"render":break;case"change":break;case"show":var i=t.value.split(":"),n=this._getField(t.value);this._watch([i.length>1?i[0]:n],'[bb-show="'+t.value+'"]:show'),this._getBoolean(BbaseEst.compile("{{"+t.value+"}}",this.model.attributes))||this.$('[bb-show="'+t.value+'"]').hide();break;case"model":this._modelBind(e,'[bb-model="'+t.value+'"]'),this._watch([t.value.split(":")[0]],'[bb-model="'+t.value+'"]:value'),this.$('[bb-model="'+t.value+'"]').val(this._get(t.value.split(":")[0]));break;case"checked":var n=this._getField(t.value);this._watch([n],'[bb-checked="'+t.value+'"]:checked'),this.$('[bb-checked="'+t.value+'"]').prop("checked",this._getBoolean(t.value));break;default:BbaseApp.getDirective(t.name)?(BbaseEst.extend(BbaseApp.getDirective(t.name),BbaseApp.getDirective(t.name).bind.call(this,t.value,"[bb-"+t.name+'="'+t.value+'"]')),this._directives_.push({name:t.name,object:BbaseApp.getDirective(t.name)})):this._handleEvents(e,t.name,t.value)}}))}this._afterTransition()},_handleEvents:function(t,e,i){var s=/:([^:\$\s\(\)]*)/gim,n=/\$([^:\$\s\(\)]*)/gim,r=/\(([^:\$]*)\)/gim,a=/(.[^:\$\s\(\)]*).*/gim,o=a.exec(i)[1],h=BbaseEst.map(i.match(s)||[],function(t){return t.replace(":","")}),l=BbaseEst.map(i.match(n)||[],function(t){return t.replace("$","")}),c=i.match(r);c&&BbaseEst.each(c[0].split(","),this._bind(function(t){var e=BbaseEst.trim(t.replace(/[\(|\)]/gim,""));BbaseEst.isEmpty(e)||l.push(e.indexOf("'")>-1?e.replace(/'/gim,""):/^[\d\.]+$/gim.test(e)?parseFloat(e):this._get(e))})),this[o]&&t.find("[bb-"+e+'="'+i+'"]').off(e).on(e,this._bind(function(t){if(h.length>0)switch(h[0]){case"enter":13===t.keyCode&&this[o].apply(this,l.concat([t]));break;default:t.keyCode===parseInt(h[0])&&this[o].apply(this,l.concat([t]))}else this[o].apply(this,l.concat([t]))}))},_stringifyJSON:function(t){var e,i;JSON.stringify||alert(CONST.LANG.JSON_TIP),BbaseEst.each(t,function(t){e=t.split("."),e.length>1?(i=BbaseEst.getValue(this.model.attributes,t),BbaseEst.setValue(this.model.attributes,t,JSON.stringify(i))):BbaseEst.setValue(this.model.attributes,t,JSON.stringify(this.model.get(t)))},this)},_parseJSON:function(t){var e,i,s=JSON.parse||$.parseJSON;s||alert(CONST.LANG.JSON_TIP),BbaseEst.each(t,function(t){e=t.split("."),e.length>1?(i=BbaseEst.getValue(this.model.attributes,t),"string"===BbaseEst.typeOf(i)&&BbaseEst.setValue(this.model.attributes,t,s(i))):"string"===BbaseEst.typeOf(this.model.get(t))&&(BbaseEst.isEmpty(this._get(t))||this._set(t,s(this.model.get(t))))},this)},_setOption:function(t){return BbaseEst.extend(this._options,t),this},_initEnterEvent:function(t){t.speed>1&&t.enter&&this.$("input").keyup($.proxy(function(e){e.keyCode===CONST.ENTER_KEY&&this.$(t.enter).click()},this))},_getOption:function(t){return this._options[t]},_getTpl:function(){return"<div>"+this._options.template+"</div>"},_getValue:function(t){return BbaseEst.getValue(this.model.attributes,t)},_get:function(t){return this._getValue.call(this,t)},_getInt:function(t){return parseInt(this._get(t),10)},_getFloat:function(t){return parseFloat(this._get(t),10)},_getDefault:function(t,e){return this._setDefault(t,e),BbaseEst.getValue(this.model.attributes,t)},_setDefault:function(t,e){var i=BbaseEst.getValue(this.model.attributes,t);("undefined"===BbaseEst.typeOf(i)||"null"===BbaseEst.typeOf(i))&&BbaseEst.setValue(this.model.attributes,t,e)},_initDefault:function(){this.init&&"function"===BbaseEst.typeOf(this.init)&&(this.__def_vals_=this.init.call(this,this._attributes)||{},BbaseEst.each(this.__def_vals_,this._bind(function(t,e){this._setDefault(e,t)})))},_reset:function(t){this.model.attributes={},t=BbaseEst.extend(BbaseEst.extend(this.model.defaults||{},this.__def_vals_),t),this._set(this._getPath(t))},_getPath:function(t,e){var i=[],s=t;for(e||(e=""),s.CONST&&delete s.CONST,s._options&&delete s._options,s._data&&delete s._data,s._isAdd&&delete s._isAdd,s.models&&delete s.models,s.children&&delete s.children;BbaseEst.keys(s).length>0;)t=s,BbaseEst.each(t,function(t,e){"object"===BbaseEst.typeOf(t)?BbaseEst.each(t,function(t,i){s[e+"."+i]=t}):i.push({path:e,value:t}),delete s[e]});return BbaseEst.each(i,this._bind(function(t){s[e+t.path]=t.value})),s},_getField:function(t){var e="",i=[],s=null;return e=t.replace(/^[!|(]*(\w+(?:\.\w+)*)(?:[\s|\.|>|<|!|:=])?.*$/gim,"$1"),i=e.replace(/({{|}})/gim,"").split(/\s/),BbaseEst.each(i,this._bind(function(t){return s=this._loopField(t),null!==s?!1:void 0})),s?s:i[0]},_loopField:function(t){var e=[];return"undefined"===BbaseEst.typeOf(this._get(t))?(e=t.split("."),1===e.length?null:(e.pop(),this._loopField(e.join(".")))):t},_getBoolean:function(t){var e=BbaseEst.compile("{{"+t+"}}",this.model.attributes);return"true"===e||"1"===e?e=!0:"false"===e||"0"===e||""===e?e=!1:"string"===BbaseEst.typeOf(e)&&BbaseEst.isEmpty(this._get(e))?e=!0:"boolean"===BbaseEst.typeOf(this._get(e))&&(e=this._get(t)),e},_isBoolean:function(t){return"true"===t||"false"===t},_getObject:function(t,e){var i={fields:{}},s=[],n="",r=BbaseEst.trim(t).substring(1,t.length-1).split(",");return BbaseEst.each(r,function(t){"string"===BbaseEst.typeOf(t)&&t.indexOf("{")>-1?n+=t+",":"string"===BbaseEst.typeOf(t)&&t.indexOf("}")>-1?(n+=t,s.push(n),n=""):n.length>0?n+=t+",":s.push(t)}),BbaseEst.each(s,function(t){var s=t.split(":"),n={};if(s[0]=BbaseEst.trim(s[0]),s[1]=BbaseEst.trim(s[1]),e)if("array"===BbaseEst.typeOf("ignore")){var r=BbaseEst.findIndex(e,function(t){return t===s[0]});if(-1!==r)return i[s[0]]=s[1],!0}else if("string"===BbaseEst.typeOf("ignore")&&e===s[0])return i[s[0]]=s[1],!0;if("string"===BbaseEst.typeOf(s[1])&&s[1].indexOf("{")>-1){var a=s.shift();i[a]=this._getObject(s.join(":"))}else s[1].indexOf("'")>-1?i[s[0]]=BbaseEst.trim(s[1].replace(/'/gim,"")):s[1]in this.model.attributes?(i[s[0]]=this._get(s[1]),i.fields[s[0]]=s[1]):this[s[1].replace(/(\(.*\))/gim,"")]?s[1].indexOf("(")>-1?(n=this._getFunction(s[1],this.model.attributes),i[s[0]]=this[n.key].apply(this,n.args)):i[s[0]]=this[s[1]]:i[s[0]]=this._isBoolean(s[1])?this._getBoolean(s[1]):BbaseEst.trim(BbaseEst.compile("{{"+s[1]+"}}",this.model.attributes))},this),i},_getFunction:function(t,e){var i=/\(([^:\$]*)\)/gim,s=null,n=BbaseEst.trim(t.replace(/\(.*\)/g,""));args=[];var r=t.match(i);return r&&BbaseEst.each(r[0].split(","),function(t){var i=BbaseEst.trim(t.split(".")[0].replace(/[\(|\)]/gim,""));s||(s=i),i&&args.push(i.indexOf("'")>-1?i.replace(/'/gim,""):/^[\d\.]+$/gim.test(i)?parseFloat(i):i in e?BbaseEst.getValue(e,i):this[i]?this[i].call(this):"")},this),{key:n,args:args}},_setValue:function(t,e){BbaseEst.equal(BbaseEst.getValue(this.model.attributes,t),e)||(BbaseEst.setValue(this.model.attributes,t,e),BbaseEst.trigger(this.cid+t,t),this._m_change_=!0)},_set:function(t,e){this._m_change_=!1,"object"===BbaseEst.typeOf(t)?this._baseSetValues(this._getPath(t)):this._setValue(t,e),this._m_change_&&this._ready_component_&&(this.options.onUpdate&&this.options.onUpdate.call(this,this.model.toJSON()),this.change&&!this.change.timer&&(this.change.timer=setTimeout(this._bind(function(){this.change.call(this,this.viewType,t),this.change.timer=null}),20)),"item"===this.viewType&&this._super("change","item"))},_baseSetValues:function(t){BbaseEst.each(t,this._bind(function(t,e){this._setValue(e,t)}))},_baseSetAttr:function(t,e){"string"===BbaseEst.typeOf(t)?BbaseEst.setValue(this.model.attributes,t,e):BbaseEst.each(t,this._bind(function(t,e){BbaseEst.setValue(this.model.attributes,e,t)}))},_setValues:function(t){this._baseSetValues(t),this._options.onChange&&this._options.onChange.call(this,t)},_setAttr:function(t,e){this._baseSetAttr(t,e)},_setAttributes:function(t,e){this._baseSetAttr(t,e),this._options.onChange&&this._options.onChange.call(this,t)},_getParam:function(t){return this.collection?this.collection.__params[t]:this.model.params[t]},_setParam:function(t,e){this.collection?this.collection._setParam(t,e):this.model.params[t]=e},_getTarget:function(t){return $(t.target?t.target:t.currentTarget)},_getEventTarget:function(t){return $(t.currentTarget?t.currentTarget:t.target)},_beforeTransition:function(){this.$el.css({visibility:"hidden"})},_afterTransition:function(){this.$el.css({visibility:"visible"})},_one:function(t,e){try{var i,s="array"===BbaseEst.typeOf(t),n=[],r=null;i=s?t.join("_"):t,r="_one_"+i,this[r]="undefined"===BbaseEst.typeOf(this[r])?!0:!1,this[r]&&(s?(BbaseEst.each(t,function(t){n.push(t.replace(/^(.+)-(\d+)?$/g,"$1"))}),this._require(n,e)):e&&e.call(this))}catch(a){debug("Error -> BbaseSuperView._one ->"+JSON.stringify(t)+a,{type:"error"})}},_require:function(t,e){seajs.use(t,BbaseEst.proxy(e,this))},_delay:function(t,e){setTimeout(BbaseEst.proxy(function(){setTimeout(BbaseEst.proxy(function(){t&&t.call(this)},this),e)},this),0)},_bind:function(t){return BbaseEst.proxy(t,this)},_parseHbs:function(t){return BbaseEst.isEmpty(t)?null:t.indexOf("_quote_")>-1?t:t.replace(/{{#If\s+(.*?)}}/gm,function(t){return"{{#If '"+t.replace(/{{#If\s+(.*)}}/gm,"$1").replace(/'/gm,"_quote_")+"'}}"})},_empty:function(){},_destroy:function(){this._re_dup=null,BbaseEst.each(this._directives_,this._bind(function(t){BbaseApp.getDirective(t.name)&&BbaseApp.getDirective(t.name).unbind&&BbaseApp.getDirective(t.name).unbind.call(this,t.object)}))},_close:function(){BbaseApp.getDialog(this.viewId)&&BbaseApp.getDialog(this.viewId).close().remove()},render:function(){this._render()},_dialog:function(t,e){var i=e||this,s=t.viewId?t.viewId:"string"===BbaseEst.typeOf(t.dialogId)?t.dialogId:t.moduleId;"function"===BbaseEst.typeOf(s)&&(s=BbaseEst.nextUid("dialog_view"));var n={width:"auto",title:null,cover:!1,autofocus:!1,hideOkBtn:!0,hideCloseBtn:!0,button:[],quickClose:t.cover?!1:"boolean"===BbaseEst.typeOf(t.autofocus)?t.quickClose:!1,skin:"dialog_min"};t.moduleId&&BbaseApp.getStatus(t.moduleId)&&(n=BbaseEst.extend(n,BbaseApp.getStatus(t.moduleId))),t=BbaseEst.extend(n,t),t=BbaseEst.extend(t,{el:"#base_item_dialog"+s,content:t.content||'<div id="'+s+'"></div>',viewId:s,onshow:function(){try{var e=t.onShow&&t.onShow.call(this,t);if("undefined"!=typeof e&&!e)return;"function"===BbaseEst.typeOf(t.moduleId)?(t.dialogId=t.dialogId||t.viewId,BbaseApp.addPanel(t.dialogId,{el:"#"+t.dialogId,template:'<div id="base_item_dialog'+t.dialogId+'" class="region '+t.dialogId+'"></div>'}).addView(t.dialogId,new t.moduleId(t))):"string"===BbaseEst.typeOf(t.moduleId)&&seajs.use([t.moduleId],function(e){try{e||console.error(t.moduleId+" is not defined"),BbaseApp.addPanel(t.viewId,{el:"#"+t.viewId,template:'<div id="base_item_dialog'+t.viewId+'" class="region"></div>'}).addView(t.viewId,new e(t))}catch(i){console.error(i)}})}catch(i){console.log(i)}},onclose:function(){BbaseApp.getPanel(t.viewId)&&BbaseApp.removePanel(t.viewId),t.onClose&&t.onClose.call(i,t),BbaseApp.getDialogs().pop()}}),a.dialog(t)},_initToolTip:function(t,e){var i=e||".tool-tip",s=t?$(i,t):this.$(i);s.hover(function(){var t=$(this).attr("data-title")||$(this).attr("title"),e=$(this).attr("data-offset")||0;BbaseEst.isEmpty(t)||(a.dialog({dialogId:BbaseEst.hash(t||"error:446"),title:null,width:"auto",offset:parseInt(e,10),skin:"tool-tip-dialog",align:$(this).attr("data-align")||"top",content:'<div style="padding: 5px 6px;;font-size: 12px;">'+t+"</div>",hideCloseBtn:!0,autofocus:!1,target:$(this).get(0)}),BbaseApp.getData("toolTipList")||BbaseApp.addData("toolTipList",[]),BbaseApp.getData("toolTipList").push(BbaseEst.hash(t)),$(window).one("click",BbaseEst.proxy(function(){BbaseEst.each(BbaseApp.getData("toolTipList"),function(t){BbaseApp.getDialog(t)&&BbaseApp.getDialog(t).close()}),BbaseApp.addData("toolTipList",[])},this)))},function(){try{BbaseApp.getDialog(BbaseEst.hash($(this).attr("data-title")||$(this).attr("title"))).close()}catch(t){}})}}),l=h.extend({_initialize:function(t){return this._initOptions(t),this._initTemplate(this._options.template),this._initModel(this._options.data,f.extend({fields:this._options.fields})),this._initBind(this._options),this.render(),this},_initOptions:function(t){this._options=BbaseEst.extend(this.options,t||{}),this._options.data=this._options.data||{},this.viewId=this._options.viewId,this.viewType="view"},_initTemplate:function(t){t&&(t=this._parseHbs(t),this.template=n.compile(t),this.$template="<div>"+t+"</div>")},_initModel:function(t,e){t&&(t.CONST=CONST),this.model=new e(t)},_initBind:function(){this.model.bind("reset",this.render,this)},_render:function(){this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this,this._options),this._options.append?this.$el.append(this.template(this.model.attributes)):this.$el.html(this.template(this.model.attributes)),this._options.modelBind&&setTimeout(this._bind(function(){this._modelBind()}),0),this.afterRender&&setTimeout(this._bind(function(){this.afterRender.call(this,this._options)}),0),this._options.onReady&&setTimeout(this._bind(function(){this._options.onReady.call(this,this._options)}),0),this._watchBind&&setTimeout(this._bind(function(){this._watchBind.call(this,this._options.template)}),0),this._bbBind&&setTimeout(this._bind(function(){this._bbBind.call(this,this._options.template,this.$el)}),0),this._options.toolTip&&setTimeout(this._bind(function(){this._initToolTip()}),0),this._initEnterEvent(this._options),this._ready_component_=!0,a.removeLoading()},render:function(){this._render()}}),c=h.extend({_initialize:function(t){return this.dx=0,this.views=[],this._initOpt(t.collection,t)},_initOpt:function(t,e){return this._initOptions(e),this._initDataModel(f.extend({})),this._initTemplate(this._options),this._initEnterEvent(this._options,this),this._initList(this._options),this._initCollection(this._options,t),this._initItemView(this._options.item,this),this._initModel(this._options.model),this._initBind(this.collection),this._initPagination(this._options),this._load(this._options),this},_initOptions:function(t){this._options=BbaseEst.extend(this.options,t||{}),this._options.sortField="sort",this._options.max=this._options.max||99999,this._options.speed=this._options.speed||9,this.viewId=this._options.viewId,this.viewType="list"},_initDataModel:function(t){this._options.data&&(this._options.data.CONST=CONST),this.model=new t(this._options.data),this._set("models",[])},_initTemplate:function(t){this._data=t.data=t.data||{},t.template&&(t.template=this._parseHbs(t.template),this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this),this.$template=$("<div>"+t.template+"</div>"),t.render?(BbaseEst.msie()?(this.__template=t.template.replace(new RegExp("\\sstyle=","img")," ng-style="),t.itemTemp=$("<div>"+this.__template+"</div>").find(t.render).html(),BbaseEst.isEmpty(t.itemTemp)||(t.itemTemp=t.itemTemp.replace(/ng-style/gim,"style"))):t.itemTemp=this.$template.find(t.render).html(),this.$template.find(t.render).empty()):(BbaseEst.msie()?(this.__template=t.template.replace(new RegExp("\\sstyle=","img")," ng-style="),t.itemTemp=$("<div>"+this.__template+"</div>").html(),BbaseEst.isEmpty(t.itemTemp)||(t.itemTemp=t.itemTemp.replace(/ng-style/gim,"style"))):t.itemTemp=this.$template.html(),this.$template.empty()),this.template=n.compile(BbaseEst.isEmpty(t.itemTemp)?t.template:this.$template.html()),this._options.append?(this.$el.empty(),this.$el.append(this.template(this.model.attributes))):this.$el.html(this.template(this.model.attributes))),t.modelBind&&this._modelBind()},_initEnterEvent:function(t,e){t.enterRender&&e.$("input").keyup(function(i){i.keyCode===CONST.ENTER_KEY&&e.$(t.enterRender).click()})},_initList:function(t){this.list=t.render?this.$(t.render):this.$el,0===this.list.size()&&(this.list=$(t.render))},_initCollection:function(t,e){e.prototype.hasOwnProperty("model")||(e.prototype.model=this._options.model),(!this.collection||this.collection&&!this.collection.remove)&&(this.collection=new e(t)),t.itemId&&this.collection._setItemId(t.itemId),t.subRender&&(this.composite=!0)
},_initItemView:function(t){this.item=t},_initModel:function(t){this.initModel=t},_initBind:function(t){t&&(t.bind("add",this._addOne,this),t.bind("reset",this._render,this)),this._watchBind&&this._watchBind.call(this,this._options.template),this._bbBind&&this._bbBind.call(this,this._options.template,this.$el)},_initPagination:function(t){var e=this;e.collection&&e.collection.paginationModel&&e.collection.paginationModel.on("reloadList",function(i){e._set("checked_all",!1),e._options.diff||e._clear.call(e),e._load.call(e,t,i)})},_load:function(t,e){var i=this;t=t||this._options||{},this._beforeLoad(t),(t.page||t.pageSize)&&(t.page&&i._setPage(t.page||1),t._page=t.page,t.pageSize&&i._setPageSize(t.pageSize||16),t._pageSize=t.pageSize,e=i.collection.paginationModel,t.page=t.pageSize=null),this._options.items&&(this._options.diff||this._empty(),this._initItems()),this._options.viewId&&i.collection.paginationModel&&i._getPageSize()<999&&(BbaseApp.addCookie(this._options.viewId+"_page"),BbaseEst.cookie(this._options.viewId+"_page",i._getPage()),BbaseApp.addCookie(this._options.viewId+"_pageSize"),BbaseEst.cookie(this._options.viewId+"_pageSize",i._getPageSize())),i.collection.url&&!this._options.items?(i._options.filter&&(i.filter=!0),i._options.subRender&&(i.composite=!0,i._setPage(1),i._setPageSize(9e3)),a.addLoading(),i.collection._load(i.collection,i,e||this.collection.paginationModel).done(function(t){t&&t.msg&&t.msg===CONST.LANG.AUTH_FAILED&&a.tip(CONST.LANG.AUTH_LIMIT+"！",{time:2e3}),t||(t={success:!1,msg:"请求未知错误"},i.errorFetch.call(i,t)),t&&!t.success&&i.errorFetch&&i.errorFetch.call(i,t),i._removeNoResult();try{i._getTotalPage()===i._getPage()&&i._set("load_completed",!0),(BbaseEst.isEmpty(t)||BbaseEst.isEmpty(t.attributes)||0===t.attributes.data.length)&&(i._handleListNode(),"notLogin"===t.msgType&&BbaseEst.trigger("checkLogin"))}catch(e){BbaseEst.trigger("checkLogin"),debug("Error4 -> _load -> "+t.msg)}i._afterLoad(t),i._options.subRender&&i._filterRoot(),t.attributes&&t.attributes.model&&(i._options.data=BbaseEst.extend(i._options.data,t.attributes.model)),i._filter(),i._resetModels(),i._ready_component_||i._finally()})):(i._afterLoad(),i._resetModels(),i._ready_component_||i._finally())},_finally:function(){this.afterRender&&setTimeout(this._bind(function(){this.afterRender.call(this,this._options)}),0),this._options.onReady&&setTimeout(this._bind(function(){this._options.onReady.call(this,this._options)}),0),this._options.toolTip&&setTimeout(this._bind(function(){this._initToolTip()}),0),this._ready_component_=!0},_resetModels:function(){this._set("models",this.collection.models),this.cms&&BbaseEst.off(this.cid+"models",this.cms),this.cms=BbaseEst.on(this.cid+"models",this._bind(function(){this._set("models",this.collection.models)})),a.removeLoading()},_filter:function(){this.filter&&(this._appendAble_=!0,this.filter.call(this),this.collection.each(this._addOne,this),this._appendAble_=!1)},_handleListNode:function(){this._set("result_none",!0),this.list.append(this._options.append?'<div class="no-result">'+CONST.LANG.LOAD_ALL+"</div>":'<div class="no-result">'+CONST.LANG.NO_RESULT+"</div>"),1===this._getPage()&&this.trigger("resultListNone"+this._options.viewId,{})},_removeNoResult:function(){this.list.find(".no-result").remove()},_reload:function(t){this._empty.call(this),this.collection.reset(),this.list.empty(),this._load(t)},_beforeLoad:function(){this.beforeLoad&&this.beforeLoad.call(this,this.collection)},_afterLoad:function(t){this.afterLoad&&this.afterLoad.call(this,t)},_initItems:function(){"function"===BbaseEst.typeOf(this._options.items)&&(this._options.items=this._options.items.apply(this,arguments)),this._options._page||this._options._pageSize?this._renderListByPagination():(BbaseEst.each(this._options.items,function(t){return this._checkStop()?!1:void this.collection.push(new this.initModel(t))},this),this._options.subRender&&this._filterRoot()),this._filter(),0===this._options.items.length&&this._handleListNode()},_setTemplate:function(t){this.compileTemp=t},_getTemplate:function(){return this.compileTemp},_stop:function(){this.stopIterator=!0},_checkStop:function(){return this.stopIterator?(this.stopIterator=!1,!0):!1},_render:function(){this._addAll(),this.trigger("after",this)},_filterRoot:function(){var t=this,e=[],i=[];t.composite=!1,BbaseEst.each(t.collection.models,function(i){e.push({categoryId:i.attributes[t._options.categoryId],belongId:i.attributes[t._options.parentId]})}),this.collection.each(function(s){for(var n=e.length,r=[];n>0;){var a=e[n-1];a.belongId+""==s.get(t._options.categoryId)+""&&(r.unshift(a.categoryId),e.splice(n-1,1)),n--}s.set("children",r),s.set("id",s.get(t._options.categoryId)),"array"===BbaseEst.typeOf(t._options.rootValue)?BbaseEst.each(t._options.rootValue,BbaseEst.proxy(function(e){"function"===BbaseEst.typeOf(e)?e.call(this,e)&&(s.set("level",1),i.push(s)):!BbaseEst.isEmpty(e)&&s.get(t._options.rootId)&&s.get(t._options.rootId).indexOf(e)>-1?(s.set("level",1),i.push(s)):s.get(t._options.rootId)===e&&(s.set("level",1),i.push(s))},this)):s.get(t._options.rootId)===t._options.rootValue&&(s.set("level",1),s.set("isroot","01"),i.push(s))}),BbaseEst.each(i,function(e){e.set("isroot","01"),t._options.diff||t._addOne(e)}),t._options.diff&&this._setModels(i)},_remove:function(t,e){var e="undefined"==typeof e?t+1:e;if(!(e>this.collection.models.length))for(;e>t;)this.collection.models[e-1].attributes.id=null,this.collection.models[e-1].view._remove(this.collection.models[e-1].get("dx")),e--},_setModels:function(t){var e=this.collection.models.length,i=t.length,s=(this._getPageSize()||16)*(this._getPage()-1||0);if(i>0&&t[0].view&&(t=BbaseEst.map(t,function(t){return t.attributes})),this.collection.each(this._bind(function(e,n){n>i-1||t[n]&&(t[n].dx=s,s++,e.view._set(this._getPath(t[n])))})),i>e)for(var n=e+1;i>=n;n++)t[n-1].dx=s,s++,this._push(new this._options.model(this._getPath(t[n-1])));else e>i&&this._remove(i,e)},_addOne:function(t,e,i){var s=this;if(!this.composite&&this.dx<this._options.max){switch(t.set({dx:this.dx++}),this._options.speed){case 1:t.set("_options",{});break;case 9:t.set("_options",{_speed:this._options.speed,_item:s._options.item,_items:s._options.items?!0:!1,_model:s._options.model,_collection:BbaseEst.isEmpty(s._options.subRender)?null:s.collection,_subRender:s._options.subRender,_collapse:s._options.collapse,_extend:s._options.extend,_checkAppend:s._options.checkAppend,_checkToggle:s._options.checkToggle,_data:s.options.data||s._options.data})}var n=new this.item({model:t,viewId:this._options.viewId,speed:this._options.speed,data:this._data,views:this.views,itemTemp:this._options.itemTemp});n._setInitModel(this.initModel),n._setViewId(this._options.viewId||BbaseApp.getCurrentView()),i&&i.at<this.collection.models.length-1&&this.collection.models.length>1?this.collection.models[0===i.at?0:i.at-1].view.$el.after(n._render().el):(!this.filter||this._appendAble_)&&this.list.append(n._render().el),this.views.push(n)}},_push:function(t,e){var i,s="number"===BbaseEst.typeOf(e)?e+1:0===this.collection.models.length?0:this.collection.models.length+1,n={at:s>this.collection.models.length?this.collection.models.length+2:s};t.cid||(t=new this.initModel(t)),this._options.items&&(i="array"===BbaseEst.typeOf(t)?BbaseEst.pluck(t,function(t){return t.attributes}):t.attributes,this._options.diff||this._options.items.splice(n.at-1,0,i)),this._appendAble_=!0,this.collection.push(t,n),this._appendAble_=!1,!BbaseEst.isEmpty(e)&&this._getLength()>1&&this._exchangeOrder(s-1,s,{}),this._resetDx(),this._setValue("checked_all",!1),BbaseEst.trigger(this.cid+"models"),this._get("result_none")&&(this.list.find(".no-result").remove(),this._set("result_none",!1))},_eq:function(t){return this.collection.models[t].view.$el},_resetDx:function(){var t=(this._getPageSize()||16)*(this._getPage()-1||0);BbaseEst.each(this.collection.models,function(e){e.view._set("dx",t),t++}),this.dx=this.collection.models.length},_findIndex:function(t){return BbaseEst.findIndex(this.collection.models,{cid:t.cid})},_renderListByPagination:function(){if(this.page=this._getPage(),this.pageSize=this._getPageSize(),this.startIndex=(this.page-1)*parseInt(this.pageSize,10),this.endIndex=this.startIndex+parseInt(this.pageSize,10),this._options.diff){for(var t=[],e=this.startIndex;e<this.endIndex;e++)if(this._options.items[e]){var i=BbaseEst.cloneDeep(this._options.items[e]);i.dx=this.startIndex+e,t.push(i)}this._setModels(t)}else for(var e=this.startIndex;e<this.endIndex;e++)this.collection.push(this._options.items[e]);return this._setCount(this._options.items.length),this.collection._paginationRender(),this.collection},_empty:function(){if(this.dx=0,this._options.append)return this.collection;if(this.collection&&!this.collection.remove,this.collection._reset&&this.collection._reset(),this.collection)for(var t=this.collection.length;t>-1;)this.collection.remove(this.collection[t]),t--;return this.collection.paginationModel&&(this.dx=(this._getPageSize()||16)*(this._getPage()-1||0)),BbaseEst.each(this.views,function(t){t.remove().off()}),this.views=[],BbaseEst.trigger(this.cid+"models"),this.collection},_clear:function(){this._empty.call(this),this.list.empty(),this.collection.models.length=0},_addAll:function(){this._empty(),this.collection.each(this._addOne,this)},_checkAll:function(t){var e,i=null;"boolean"===BbaseEst.typeOf(t)?this._setValue("checked_all",t):t?(i=this._getEventTarget(t),i.is("checkbox")?this._setValue("checked_all",i.get(0).checked):this._setValue("checked_all",!this._getValue("checked_all"))):this._setValue("checked_all",!this._getValue("checked_all")),e=this._getValue("checked_all"),this.collection.each(function(t){t.view._check(e),t.view.render()}),this._checkedAll(this._getValue("checked_all"))},_checkedAll:function(t){this._setValue("checked_all",t)},_saveSort:function(t){var e={id:t.get("id")};e[this._options.sortField||"sort"]=t.get(this._options.sortField),t._saveField(e,this,{async:!1,hideTip:!0})},_saveSorts:function(t,e){var i={id:t.get("id")};i.sorts=e,t._saveField(i,this,{async:!1,hideTip:!0})},_insertOrder:function(t,e,i){e>t&&e++,BbaseEst.arrayInsert(this.collection.models,t,e,{arrayExchange:BbaseEst.proxy(function(t,e,i){this._exchangeOrder(e,i,{path:this._options.sortField||"sort",success:function(t,e){t.get("id")&&e.get("id")?(t.stopCollapse=!1,e.stopCollapse=!1):debug("Error8 -> _insertOrder")}})},this),callback:function(t){i&&i.call(this,t)}}),this._resetDx()},_exchangeOrder:function(t,e,i){var s={},n={},r=this.collection.at(t),a=this.collection.at(e);if(r.view&&a.view){var o=r.view.model.get("dx"),h=a.view.model.get("dx");s.dx=h,n.dx=o}if(i.path){var l=r.view.model.get(i.path),c=a.view.model.get(i.path);s[i.path]=c,n[i.path]=l}return r.view.model.stopCollapse=!0,a.view.model.stopCollapse=!0,this.collection.models[e]=this.collection.models.splice(t,1,this.collection.models[e])[0],r.view._set(s),a.view._set(n),e>t?r.view.$el.before(a.view.$el).removeClass("hover"):r.view.$el.after(a.view.$el).removeClass("hover"),r.view.$el.hasClass("bui-grid-row-even")?(r.view.$el.removeClass("bui-grid-row-even"),a.view.$el.addClass("bui-grid-row-even")):(r.view.$el.addClass("bui-grid-row-even"),a.view.$el.removeClass("bui-grid-row-even")),i.success&&i.success.call(this,r,a),this},_moveUp:function(t){var e,i,s=this,n=this.collection.indexOf(t),r=[];if(this._options.subRender){i=t.get(this._options.parentId),this.collection.each(function(t){i===t.get(s._options.parentId)&&r.push(t)});var a=BbaseEst.findIndex(r,function(e){return e.get("id")===t.get("id")});if(0===a)return;e=this.collection.indexOf(r[a-1])}else{if(0===n)return;e=n-1}this._exchangeOrder(n,e,{path:this._options.sortField||"sort",success:function(t,e){t.get("id")&&e.get("id")?(this._saveSorts(t,{ids:t.get("id")+","+e.get("id"),sorts:t.get(this._options.sortField||"sort")+","+e.get(this._options.sortField||"sort")}),t.stopCollapse=!1,e.stopCollapse=!1):debug("Error8 -> _moveUp")}})},_moveDown:function(t){var e,i,s=this,n=this.collection.indexOf(t),r=[];if(this._options.subRender){i=t.get(s._options.parentId),this.collection.each(function(t){i===t.get(s._options.parentId)&&r.push(t)});var a=BbaseEst.findIndex(r,function(e){return e.get("id")===t.get("id")});if(a===r.length-1)return;e=this.collection.indexOf(r[a+1])}else{if(n===this.collection.models.length-1)return;e=n+1}this._exchangeOrder(n,e,{path:this._options.sortField,success:function(t,e){t.get("id")&&e.get("id")?(this._saveSorts(t,{ids:t.get("id")+","+e.get("id"),sorts:t.get(this._options.sortField||"sort")+","+e.get(this._options.sortField||"sort")}),t.stopCollapse=!1,e.stopCollapse=!1):debug("Error8 -> _moveDown")}})},_getCheckboxIds:function(t){return BbaseEst.pluck(this._getCheckedItems(),BbaseEst.isEmpty(t)?"id":"attributes."+t)},__filter:function(t){return t.attributes.checked},_getCheckedItems:function(t){return t?BbaseEst.chain(this.collection.models).filter(this.__filter).pluck("attributes").value():BbaseEst.chain(this.collection.models).filter(this.__filter).value()},_getItems:function(t){return BbaseEst.map(this.collection.models,function(e){return e.toJSON(t)})},_getItem:function(t){var e=this._getItems();return t=t||0,e.length>t?e[t]:null},_add:function(t){this.collection.push(t)},_batch:function(t){var e=this;return t=BbaseEst.extend({tip:CONST.LANG.SUCCESS+"！"},t),this.checkboxIds=this._getCheckboxIds(t.field||"id"),0===this.checkboxIds.length?void a.tip(CONST.LANG.SELECT_ONE+"！"):void(t.url?$.ajax({type:"POST",async:!1,url:t.url,data:{ids:e.checkboxIds.join(",")},success:function(i){a.tip(i.success?t.tip:i.msg),e._load(),BbaseEst.trigger(e.cid+"models"),t.callback&&t.callback.call(e,i)}}):(BbaseEst.each(this._getCheckedItems(),function(t){t.destroy()}),BbaseEst.trigger(e.cid+"models"),t.callback&&t.callback.call(e)))},_batchDel:function(t,e){var i=this,s=null,n="id",r=this._getEventTarget(t);return r.size()>0?(s=r.attr("data-url"),n=r.attr("data-field")||"id"):(s=t.url,id=t.id||"id"),this.checkboxIds=this._getCheckboxIds(n),this.checkboxIds&&0===this.checkboxIds.length?void a.tip(CONST.LANG.SELECT_ONE):void a.confirm({success:function(){i._batch({url:s,field:n,tip:CONST.LANG.DEL_SUCCESS,callback:e})}})},_clearChecked:function(t){BbaseEst.each(this.collection.models,function(e){BbaseEst.equal(e._previousAttributes.checked,e.attributes.checked)&&!t||!e.view||(e.attributes.checked=!1,BbaseEst.trigger(e.view.cid+"checked","checked"))})},_getPage:function(){return this.collection.paginationModel.get("page")},_setPage:function(t){this.collection.paginationModel.set("page",t)},_getTotalPage:function(){return this._getCount()%this._getPageSize()==0?this._getCount()/this._getPageSize():Math.floor(this._getCount()/this._getPageSize())+1},_getCount:function(){return this.collection.paginationModel.get("count")},_setCount:function(t){this.collection.paginationModel.set("count",t)},_getPageSize:function(){return this.collection.paginationModel.get("pageSize")},_setPageSize:function(t){this.collection.paginationModel.set("pageSize",t)},_getLength:function(){return this.collection.models.length}}),u=h.extend({_initialize:function(t){this._initOptions(t),this._initCollapse(this.model.get("_options")),this._initTemplate(this._options),this._initBind(this._options),this._initView(this._options),this._initStyle(this._options),this._initEnterEvent(this._options)},_initOptions:function(t){this._options=BbaseEst.extend(this.options,t||{}),this._options.speed=this._options.speed||9,this.viewId=this._options.viewId,this.viewType="item"},_initCollapse:function(t){t._speed>1&&(this.model.stopCollapse=!1,this.collapsed=t?t._extend:!1)},_initTemplate:function(t){t.template=this.template||t.template||t.itemTemp,t.template&&(this.$template="<div>"+t.template+"</div>",t.viewId?BbaseApp.getCompileTemp(t.viewId)||BbaseApp.addCompileTemp(t.viewId,n.compile(this._parseHbs(t.template))):this.hbstemplate=n.compile(this._parseHbs(t.template)))},_initBind:function(t){t.speed>1&&(this.model.bind("reset",this.render,this),this.model.bind("change",this.render,this),this.model.bind("destroy",this.remove,this))},_initView:function(t){t.speed>1&&(this.model.view&&this.model.view.remove(),this.model.view=this)},_initStyle:function(t){if(t.speed>1){var e=this._get("id")?this._get("id")+"":this._get("dx")+1+"";this._get("dx")%2===0&&this.$el.addClass("bui-grid-row-even"),this.$el.addClass("_item_el_"+(this.viewId||"")+"_"+e.replace(/^[^1-9]+/,"")),this.$el.hover&&this.$el.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}},_render:function(){this._onBeforeRender(),this._options&&this._options.filter&&this._options.filter.call(this,this.model),this._beforeTransition(),this.$el.html(this.hbstemplate?this.hbstemplate(this.model.attributes):this.viewId&&BbaseApp.getCompileTemp(this.viewId)&&BbaseApp.getCompileTemp(this.viewId)(this.model.attributes)),this._onAfterRender();var t=this._get("_options");if(t&&t._subRender&&this._get("children")&&this._get("children").length>0){var e=this,i=this._get("level")||1,s=this.$(t._subRender+":first");this._setupEvents(t),BbaseEst.each(this.model._getChildren(t._collection),function(n){var r=null;n.set("_options",t),n.set("level",i+1),r=new t._item({model:n,data:e._options._data}),r._setInitModel(e.initModel),r._setViewId(e._options.viewId),n.view=r,s.append(r.$el),e._options.views&&e._options.views.push(r),r._render()})}return this},_setViewId:function(t){this._options&&(this._options.viewId=this.viewId=t)},_setInitModel:function(t){this.initModel=t},_setupEvents:function(t){var e=this;e._toggleCollapse.call(this,t),this.$(t._collapse+":first").click(function(){e._toggleCollapse.call(e,t)})},_toggleCollapse:function(t){var e=this;return this.model.stopCollapse?void this.$(t._subRender+":first").addClass("hide"):(e.collapsed=!e.collapsed,void(e.collapsed?(this.$(t._collapse+":first").removeClass("x-caret-down"),this.$(t._subRender+":first").slideUp(CONST.COLLAPSE_SPEED).addClass("hide")):(this.$(t._collapse+":first").addClass("x-caret-down"),this.$(t._subRender+":first").slideDown(CONST.COLLAPSE_SPEED).removeClass("hide"))))},_onBeforeRender:function(){this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this,this.model)},_onAfterRender:function(){this._options.modelBind&&setTimeout(this._bind(function(){this._modelBind()}),0),this._options.toolTip&&setTimeout(this._bind(function(){this._initToolTip()}),0),this.afterRender&&setTimeout(this._bind(function(){this.afterRender.call(this,this.model)}),0),this._watchBind&&setTimeout(this._bind(function(){this._watchBind.call(this,this._options.template)}),0),this._bbBind&&setTimeout(this._bind(function(){this._bbBind.call(this,this._options.template,this.$el)}),0),this._ready_component_=!0},_close:function(){this.stopListening()},_clear:function(){this.model.destroy()},_check:function(t){var e=this._get("checked"),i=null,s=null,n=null,r=!0;this._checkAppend="undefined"==typeof this._get("_options")._checkAppend?!1:this._get("_options")._checkAppend,this._checkToggle="undefined"==typeof this._get("_options")._checkToggle?!1:this._get("_options")._checkToggle,this._checkAppend||this.viewId&&BbaseApp.getView(this.viewId)&&BbaseApp.getView(this.viewId)._clearChecked(),this._checkToggle?this._set("checked","boolean"===BbaseEst.typeOf(t)?t:!e):(this._set("checked","boolean"===BbaseEst.typeOf(t)?t:!0),this._itemActive({add:this._checkAppend},t)),this._get("checked")&&this._checkToggle?this._itemActive({add:this._checkAppend},t):this._checkToggle&&(this.$el.removeClass("item-active"),this._set("checked",!1)),t&&t.shiftKey&&this._checkAppend?(i=BbaseApp.getData("curChecked"),s=this._get("dx"),BbaseEst.each(this.model.collection.models,function(t){n=t.get("dx"),n>i&&s>n&&(t.view._set("checked",!0),t.view.$el.addClass("item-active"))})):BbaseApp.addData("curChecked",this._get("dx")),"boolean"!==BbaseEst.typeOf(t)&&t&&BbaseEst.trigger(this.cid+"checked","checked"),this._get("checked")?BbaseEst.each(this.model.collection.models,function(t){t.attributes.checked||(r=!1)}):r=!1,BbaseApp.getView(this.viewId)&&BbaseApp.getView(this.viewId)._checkedAll(r)},_itemActive:function(t,e){var i=null;t=t||{},BbaseApp.getData("itemActiveList"+this.viewId)||BbaseApp.addData("itemActiveList"+this.viewId,[]);var s=BbaseApp.getData("itemActiveList"+this.viewId);t.add||(BbaseEst.each(s,BbaseEst.proxy(function(t){$("."+t,BbaseApp.getView(this.viewId)?BbaseApp.getView(this.viewId).$el:$("body")).removeClass("item-active")},this)),s.length=0),("boolean"!==BbaseEst.typeOf(e)||e)&&(this.$el.addClass("item-active"),i=this.$el.attr("class").replace(/^.*(_item_el_.+?)\s+.*$/g,"$1"),-1===BbaseEst.findIndex(s,function(t){return t===i})&&s.push(i))},_moveUp:function(t){return t.stopImmediatePropagation(),this.collapsed=!0,this.viewId?void BbaseApp.getView(this.viewId)._moveUp(this.model):!1},_moveDown:function(t){return t.stopImmediatePropagation(),this.collapsed=!0,this.viewId?void BbaseApp.getView(this.viewId)._moveDown(this.model):!1},_saveSort:function(){var t=this,e=this.$(".input-sort").val();this.model._saveField({id:this._get("id"),sort:e},t,{success:function(){t.model.set("sort",e)},fail:function(){},hideTip:!0})},_save:function(){this.model.attributes._response&&delete this.model.attributes._response,this.beforeSave&&this.beforeSave.call(this),BbaseEst.off("errorSave"+this.model.cid).on("errorSave"+this.model.cid,this._bind(function(t,e){this.errorSave&&this.errorSave.call(this,e)}));var t=this.model.save({},{silent:this._options.diff,wait:!0});this.afterSave&&this.afterSave.call(this,t)},_getPage:function(){var t=this.model.collection.paginationModel;return t?t.get("page"):1},_del:function(t,e){t&&t.stopImmediatePropagation();var i=this;return BbaseApp.getData("delItemDialog")&&BbaseApp.getData("delItemDialog").close(),i.model.get("children").length>0?void a.confirm({title:CONST.LANG.TIP,width:300,content:CONST.LANG.DEL_TIP}):void BbaseApp.addData("delItemDialog",a.confirm({title:CONST.LANG.WARM_TIP,content:'<div class="item-delete-confirm">'+CONST.LANG.DEL_CONFIRM+"</div>",target:t&&this._getTarget(t).get(0),success:function(){BbaseEst.isEmpty(i.model.url())&&(i.model.attributes.id=null),i.model.destroy({wait:!0,error:function(t,e){var i=[];i.push({value:CONST.LANG.CONFIRM,callback:function(){this.close()},autofocus:!0}),a.dialog({title:CONST.LANG.TIP+"：",content:e.msg,width:250,button:i})},success:function(t,s){i._removeFromItems(i.model.get("dx")),i.model.deleteTip&&a.tip(s.msg),e&&e.call(i)}})}}))},_remove:function(t,e){this.model.destroy({wait:!0,success:this._bind(function(){this._removeFromItems(this.model.get("dx")),e&&e.call(this)})})},_removeFromItems:function(t){BbaseEst.trigger(this._super("view").cid+"models"),"undefined"!==BbaseEst.typeOf(t)&&BbaseApp.getView(this.viewId)&&(BbaseApp.getView(this.viewId)._options.items&&(BbaseApp.getView(this.viewId)._options.diff||BbaseApp.getView(this.viewId)._options.items.splice(t,1)),BbaseApp.getView(this.viewId)._resetDx())}}),p=BbaseBackbone.Model.extend({defaults:{page:1,pageSize:16,count:0},initialize:function(){}}),d=BbaseBackbone.Collection.extend({constructor:function(t){this.options=t||{},BbaseBackbone.Collection.apply(this,[null,arguments])},_super:function(t,e){if("object"===BbaseEst.typeOf(t))this._initialize(t);else switch(t){case"data":return BbaseApp.getView(this.options.viewId)?BbaseApp.getView(this.options.viewId).model.toJSON():this.options.data;case"model":if(BbaseApp.getView(this.options.viewId))return BbaseApp.getView(this.options.viewId).model;var i=this.model;return new i(this.options.data);case"view":return BbaseApp.getView(this.options.viewId);default:return BbaseApp.getView(this.options.viewId)[t]&&BbaseApp.getView(this.options.viewId)[t](e),this}},_initialize:function(){this._baseUrl=this.url,this.__params=this.__params||{},this.paginationModel||(this.paginationModel=new p({page:this.options.page||1,pageSize:this.options.pageSize||16}))},initialize:function(){this._initialize()},parse:function(t){var e=this;return BbaseEst.isEmpty(t)?[]:(!t.success&&t.msg&&("notLogin"!==t.msgType||BbaseEst.isEmpty(this.url)?"nopriv"===t.msgType&&CONST.NO_PRIV?CONST.NO_PRIV.indexOf("#/")>-1?e._navigate(CONST.NO_PRIV,!0):window.location.href=CONST.NO_PRIV:a.tip(t.msg,{zIndex:5e3}):BbaseEst.trigger("checkLogin")),this._parsePagination(t),this._parseUrl(this.paginationModel),this.options.pagination&&this.paginationModel&&this._paginationRender(),t.attributes.data)},_parseUrl:function(t){var e=1,i=16;if(t&&t.get("pageSize")&&(i=t.get("pageSize"),e=t.get("page")),this.options.subRender&&(e=1,i=9e3),"function"!=typeof this.url){var s="";BbaseEst.isEmpty(this._itemId)||(s="/"+this._itemId),this.url=this._baseUrl+s+"?page="+e+"&pageSize="+i+this._getParams()}},_setParam:function(t,e){this.__params[t]=e,this._parseUrl(this.paginationModel)},_getParam:function(t){return this.__params[t]},_getParams:function(){var t="";return BbaseEst.each(this.__params,function(e,i){t+="&"+i+"="+e},this),t},_parsePagination:function(t){t.attributes=t.attributes||{page:1,per_page:10,count:10},this.paginationModel&&(this.paginationModel.set("page",t.attributes.page||1),this.paginationModel.set("pageSize",t.attributes.per_page||16),this.paginationModel.set("count",t.attributes.count||1))},_paginationRender:function(){seajs.use(["Pagination"],BbaseEst.proxy(function(t){if(t)if(this.pagination)this.pagination.render();else{var e=$(this.options.el),i="string"===BbaseEst.typeOf(this.options.pagination),s=$(i?this.options.pagination:"#pagination-container",e.size()>0?e:$("body"));i&&this.paginationModel.set("numLength",parseInt(s.attr("data-numLength")||7,10)),this.pagination=new t({el:s,model:this.paginationModel})}},this))},_load:function(t,e,i){return this._parseUrl(i),t.fetch({success:function(){e.options.diff||e._empty()},cacheData:this.options.cache,session:this.options.session})},_setItemId:function(t){this._itemId=t},_set:function(t){return this._super("view")._setModels(t)},_empty:function(){if(this.collection){for(var t=this.collection.length;t>-1;)this.collection.remove(this.collection[t]),t--;BbaseEst.trigger(this._super("view").cid+"models")}}}),f=BbaseBackbone.Model.extend({defaults:{checked:!1,checked_all:!1,load_completed:!1,result_none:!1,children:[]},baseId:"",url:function(){var t=this.baseUrl,e="";if(!t)return"";"function"===BbaseEst.typeOf(t)&&(t=t.call(this)),this.params=this.params?this.params+this._getParams():this._getParams();var i=BbaseEst.isEmpty(this.params)?"":"?";return this.isNew()&&BbaseEst.isEmpty(this.id)?t+i+this.params:e=t+("/"==t.charAt(t.length-1)?"":"/")+this.id+i+this.params},_initialize:function(){this.validateMsg=null,this.__params=this.__params||{}},parse:function(t){var e=this,i=[],s=!1;if("msg"in t&&a.removeLoading(),BbaseEst.isEmpty(t)){{"function"===BbaseEst.typeOf(this.url)?this.url():this.url}return a.tip(CONST.LANG.REQUIRE_FAILED),!1}if(t&&t.msg&&t.msg===CONST.LANG.AUTH_FAILED&&a.tip(CONST.LANG.AUTH_LIMIT,{time:2e3}),"notLogin"!==t.msgType||this.stopCheckLogin?"nopriv"===t.msgType&&CONST.NO_PRIV&&(CONST.NO_PRIV.indexOf("#/")>-1?e._navigate(CONST.NO_PRIV,!0):window.location.href=CONST.NO_PRIV):BbaseEst.trigger("checkLogin"),t.msg&&!this.hideTip&&(t.success&&e.isNew()&&this.continueAdd&&(i.push({value:CONST.LANG.ADD_CONTINUE,callback:function(){e.set("id",null),e.set(e.baseId,null)}}),s=!0),this.saveTip&&i.push({value:CONST.LANG.CONFIRM,callback:function(){this.close()},autofocus:!0}),i.length>0)){{a.dialog({id:"dialog_msg",title:CONST.LANG.TIP,content:'<div style="padding: 20px;">'+t.msg+"</div>",width:250,button:i})}this.continueAdd||setTimeout(function(){BbaseApp.getDialog("dialog_msg")&&(e.autoHide||!s)&&BbaseApp.getDialog("dialog_msg").close().remove()},2e3)}if("boolean"===BbaseEst.typeOf(t.success)&&!t.success)return e.attributes._response=t,BbaseEst.trigger("errorSave"+e.cid,t),e.attributes;if(t.attributes&&t.attributes.data){var n=BbaseEst.keys(t.attributes);n.length>1&&BbaseEst.each(n,function(e){"data"!==e&&(t.attributes.data[e]=t.attributes[e])}),t=t.attributes.data}return t&&(t.id=t[e.baseId||"id"],t.checked=!1,t.time=(new Date).getTime()),t},_saveField:function(t,e,i){var s=i.async||!0,n=new e.initModel({id:t.id||e.model.get("id")});n.clear(),n.set(t),n.set("silent",!0),i.hideTip&&(n.hideTip=!0),n.hideOkBtn=!0,n.set("editField",!0),n.baseUrl?n.save(null,{success:function(s,n){"notLogin"!==n.msgType||this.stopCheckLogin||BbaseEst.trigger("checkLogin"),"undefined"!=typeof i.success&&i.success&&i.success.call(e,t,n)},wait:s}):i.success&&i.success.call(e,t,{})},_getChildren:function(t){return BbaseEst.map(this.get("children"),function(e){return"string"==typeof e||"number"==typeof e?t.get(e):e})},_hideTip:function(){this.hideTip=!0},_toggle:function(){this.set("checked",!this.get("checked"))},_validation:function(t,e){return!t.silent&&e&&e.call(this,t),this.validateMsg},_getValue:function(t){return BbaseEst.getValue(this.attributes,t)},_setValue:function(t,e){BbaseEst.setValue(this.attributes,t,e)},_set:function(t,e){return this.view?this.view._set(t,e):this._setValue(t,e)},_get:function(t){return this.view?this.view._get(t):this._getValue(t)},_getInt:function(t){return parseInt(this._get(t),10)},_getFloat:function(t){return parseFloat(this._get(t),10)},_setParam:function(t,e){this.__params[t]=e},_getParam:function(t){return this.__params[t]},_getParams:function(){var t="";return BbaseEst.each(this.__params,function(e,i){t+="&"+i+"="+e},this),t},initialize:function(){this._initialize()}}),g=h.extend({_initialize:function(t){this._initOptions(t),this._initTemplate(this._options),this._initList(this._options),this._initModel(t.model,this),this._initEnterEvent(this._options)},_initOptions:function(t){this._options=BbaseEst.extend(this.options,t||{}),this._options.speed=this._options.speed||9,this.viewId=this._options.viewId,this.viewType="detail"},_initTemplate:function(t){return this._data=t.data=t.data||{},t.template&&(this.template=n.compile(this._parseHbs(t.template)),this.$template="<div>"+t.template+"</div>"),this._data},_initList:function(t){return this.list=t.render?this.$(t.render):this.$el,0===this.list.size()&&(this.list=$(t.render)),this.list},_render:function(){this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this,this._options),this._options.append||this.list.empty(),this.list.append(this.template(this.model.attributes)),this._options.modelBind&&setTimeout(this._bind(function(){this._modelBind()}),0),window.topDialog&&this.$(".form-actions").hide(),this._watchBind&&setTimeout(this._bind(function(){this._watchBind.call(this,this._options.template)}),0),this._bbBind&&setTimeout(this._bind(function(){this._bbBind.call(this,this._options.template,this.$el)}),0),this.afterRender&&setTimeout(this._bind(function(){this.afterRender.call(this,this._options)}),0),this._options.onReady&&setTimeout(this._bind(function(){this._options.onReady.call(this,this._options)}),0),this._options.toolTip&&setTimeout(this._bind(function(){this._initToolTip()}),0),this._options.form&&(this._formList=this._options.form.split(":"),this._form(this._formList[0])._initSubmit({beforeSave:this.beforeSave,afterSave:this.afterSave},this._formList.length>1?this._formList[1]:null)),this._ready_component_=!0,a.removeLoading()},_initModel:function(t,e){this._options.id="number"===BbaseEst.typeOf(this._options.id)?this._options.id+"":this._options.id,this._options.data.id="number"===BbaseEst.typeOf(this._options.data.id)?this._options.data.id+"":this._options.data.id,e.passId=this.options.id||this._options.data.id||BbaseEst.getUrlParam("id",window.location.href),BbaseEst.isEmpty(this.passId)?(e.passId=(new Date).getTime(),e.model=new t(this._options.data||{}),e.model.set("_data",e._options.data),e.model.set("_isAdd",e._isAdd=!0),e.render()):(e.model=new t,e.model.set("id",e.passId),e.model.set("_data",e._options.data),e.model.set("CONST",CONST),e.beforeLoad&&e.beforeLoad.call(this),e.model.fetch().done(function(t){"notLogin"===t.msgType&&BbaseEst.trigger("checkLogin"),t.success||e.errorFetch&&e.errorFetch.call(e,t),e._attributes=t.attributes,e.model.set("_isAdd",e._isAdd=!1),e.afterLoad&&e.afterLoad.call(e,t),e.render()
})),this._options.hideOkBtn&&(e.model.hideOkBtn=!0),this._options.hideSaveBtn&&(e.model.hideSaveBtn=!0),this._options.autoHide&&(e.model.autoHide=!0)},_form:function(t){return this.formSelector=t,this.formElemnet=this.$(this.formSelector),this},_validate:function(){return this},_initSubmit:function(t,e){var i=this,s=!0,n=!0;t=t||{},$(e||"#submit",this.$el).on("click",function(){var e=$(this),r=e.is("input"),a=i.preText=r?e.val():e.html();s=!0;try{i.formElemnet.submit()}catch(o){}if($("input, textarea, select",$(i.formElemnet)).each(function(){var t,e,n,r,a;t=$(this).attr("name"),$(this).hasClass("bui-form-field-error")&&(s=!1);var o=$(this).attr("id");if(o&&-1!==o.indexOf("model")){switch(this.type){case"radio":e=$(this).is(":checked")?$(this).val():n=!0;break;case"checkbox":e=$(this).is(":checked")?BbaseEst.isEmpty($(this).attr("true-value"))?!0:$(this).attr("true-value"):BbaseEst.isEmpty($(this).attr("false-value"))?!1:$(this).attr("false-value");break;default:e=$(this).val()}if(!n)if(r=o.replace(/^model\d?-(.+)$/g,"$1"),a=r.split("."),a.length>1)try{i.model.attributes[a[0]]||(i.model.attributes[a[0]]={}),BbaseEst.setValue(i.model.attributes,r,e)}catch(h){debug("Error18 -> _initSubmit -> "+h)}else i.model.set(a[0],e)}}),s){if("undefined"!=typeof t.beforeSave&&(n=t.beforeSave.call(i)),"undefined"!==BbaseEst.typeOf(n)&&!n)return!1;r?e.val(CONST.LANG.SUBMIT):e.html(CONST.LANG.SUBMIT),e.prop("disabled",!0),BbaseEst.isEmpty(i.model.url())||i._save(function(s){t.afterSave&&(t.afterSave=BbaseEst.inject(t.afterSave,function(){return new BbaseEst.setArguments(arguments)},function(){r?e.val(a):e.html(a),e.prop("disabled",!1)}),t.afterSave.call(i,s,"string"===BbaseEst.typeOf(s)?{msg:null,msgType:null,success:!0}:"boolean"===BbaseEst.typeOf(BbaseEst.getValue(s,"attributes._response.success"))?BbaseEst.getValue(s,"attributes._response"):{msg:null,msgType:null,success:!0})),e.html(a)},function(e){"notLogin"===e.msgType&&BbaseEst.trigger("checkLogin"),i.errorSave&&i.errorSave.call(i,e),t.onErrorSave&&t.onErrorSave.call(i,e)}),setTimeout(function(){e.html(a),e.prop("disabled",!1)},5e3)}return!1})},_save:function(t,e){this._saveItem(t,e)},_saveItem:function(t,e){BbaseEst.isEmpty(this.model.url())||(this.model.attributes._response&&delete this.model.attributes._response,BbaseEst.off("errorSave"+this.model.cid).on("errorSave"+this.model.cid,this._bind(function(t,e){this.errorSave&&this.errorSave.call(this,e)})),this.model.save(null,{wait:!0,success:function(e){BbaseApp.addModel(BbaseEst.cloneDeep(e.attributes)),top&&(top.model=e.attributes),t&&"function"==typeof t&&t.call(this,e)},error:function(i,s,n){200===s.status?t.call(this,s.responseText):e&&"function"==typeof e&&e.call(this,s,i,n)}}))},_empty:function(){this.model.off(),this.$el.empty().off()}});window.BbaseModel=f,window.BbaseCollection=d,window.BbaseItem=u,window.BbaseDetail=g,window.BbaseList=c,window.BbaseService=o,window.BbaseView=l,window.BbaseUtils=a,window.BbaseHandlebars=n,BbaseApp.addDirective("disabled",{bind:function(t,e){return this._watch([this._getField(t)],e+":disabled"),this.$(e).prop("disabled",this._getBoolean(t)),{compile:BbaseEst.compile("{{"+t+"}}")}},update:function(t,e,i,s){e.prop("disabled",this._getBoolean(s))}}),BbaseApp.addDirective("src",{bind:function(t){var e=!1,i="";t.indexOf("{{")>-1?(e=!0,i=n.compile(t)(this.model.attributes)):i=BbaseEst.compile("{{"+t+"}}",this.model.attributes),i=i.replace(/&amp;/gim,"&").replace(/\\/gim,"/");var s=this.$('[bb-src="'+i+'"]').eq(0);0===s.size()&&(s=this.$('[bb-src="'+t+'"]').eq(0)),s.attr("src",i),s.attr("bb-src",t),s.addClass("directive_"+BbaseEst.hash('[bb-src="'+t+'"]')),this._watch([this._getField(t)],'[bb-src="'+t+'"]:src')},update:function(t,e,i,s){e.attr("src",s)}}),BbaseApp.addDirective("sortable",{bind:function(t,e){var i=this._getObject(t);this._require(["BbaseSortable"],function(t){this.sortable=t.create(this.$(e).get(0),{animation:150,handle:i.handle,draggable:i.draggable,onStart:function(){},onEnd:this._bind(function(t){this._insertOrder&&this._insertOrder(t.oldIndex,t.newIndex,function(){})})})})},unbind:function(){this.sortable&this.sortable.destory&&(this.sortable.destory(),this.sortable=null)}}),BbaseApp.addDirective("uiselect",{bind:function(t,e){var i=this._getObject(t,"cur");this._require(["BbaseSelect"],function(t){var s=i.viewId;this._region(s,t,{el:this.$(e),target:i.target,postData:i.postData,cur:this._getDefault(i.cur,i["default"]||""),items:i.items,onChange:this._bind(function(t,e,s,n){return"undefined"==typeof this.model.attributes[i.cur]||BbaseEst.isEmpty(i.cur)||e||this._set(i.cur,t.value),i.onChange?i.onChange.apply(this,[t,e,s,n]):void 0})}),"undefined"==typeof this.model.attributes[i.cur]||BbaseEst.isEmpty(i.cur)||this._watch([i.cur],"",function(){this._view(s).setValue(this._get(i.cur))})})}}),BbaseApp.addDirective("uiradio",{bind:function(t,e){s.apply(this,[t,e,"radio"])}}),BbaseApp.addDirective("uicheckbox",{bind:function(t,e){s.apply(this,[t,e,"checkbox"])}}),BbaseApp.addDirective("uiitemcheck",{bind:function(t,e){s.apply(this,[t,e,"normal"])}}),BbaseApp.addDirective("uiitemtab",{bind:function(t,e){s.apply(this,[t,e,"tab"])}}),BbaseEst.each(app.getAllStatus(),function(t,e){n.registerHelper(e,function(i,s){var n="";return BbaseEst.isEmpty(s)?this[e]:(BbaseEst.each(t,function(t){return t.value===i?(n=BbaseEst.isEmpty(t.html)?t.text:t.html,!1):void 0}),n)})}),i.exports=window.BbaseApp});